(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{2355:function(e,t,r){Promise.resolve().then(r.bind(r,4961))},4961:function(e,t,r){"use strict";r.d(t,{default:function(){return ek}});var l,i,a=r(7437),s=r(2265),n=r(7748),o=r.n(n),c=r(8124),d=r(9397),u=r(1047),m=r(7416),p=r(1349),h=r(7586);r(1322);let g={1:[-111.07,44.66],2:[-110.57,45.6],3:[-112.7,45.53],4:[-114.05,46.83],5:[-115.09,47.3],6:[-114.18,48.36],7:[-111.08,48.31],8:[-111.42,46.15],9:[-111.27,45.5],10:[-111.6,45.9],11:[-110.79,45.11],12:[-113.68,46.72],13:[-114.13,48.5],14:[-115.55,48.4],15:[-115.32,48.4],16:[-107.75,45.46],17:[-113.76,46.9]},v={riverBase:"#4a6a78",riverSelected:"#245a74",good:"#2f5d50",fair:"#8a6d3b",tough:"#6b7280",warning:"#9b4d3a"},y="GPfE5wv1XdVEF8YyaMfc",x=!!y;function f(e){let t={id:"esri_satellite",type:"raster",tiles:["https://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}"],tileSize:256,attribution:"Esri, Maxar, Earthstar Geographics"};return JSON.stringify({version:8,sources:e?{esri_satellite:t,esri_labels:{id:"esri_labels",type:"raster",tiles:["https://services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Boundaries_and_Places/MapServer/tile/{z}/{y}/{x}"],tileSize:256,attribution:"Esri"}}:{esri_satellite:t},layers:e?[{id:"esri_satellite",type:"raster",source:"esri_satellite"},{id:"esri_labels",type:"raster",source:"esri_labels",paint:{"raster-opacity":.92}}]:[{id:"esri_satellite",type:"raster",source:"esri_satellite"}],glyphs:"https://demotiles.maplibre.org/font/{fontstack}/{range}.pbf"})}let b=[{id:"hybrid",label:"Hybrid",styleUrl:x?"https://api.maptiler.com/maps/hybrid/style.json?key=".concat(y):"data:application/json,".concat(encodeURIComponent(f(!0))),defaultOn:!0,enabled:!0},{id:"dark",label:"Dark",styleUrl:"https://basemaps.cartocdn.com/gl/dark-matter-gl-style/style.json",enabled:!0},{id:"light",label:"Light",styleUrl:"https://basemaps.cartocdn.com/gl/voyager-gl-style/style.json",enabled:!0},{id:"satellite",label:"Satellite",styleUrl:x?"https://api.maptiler.com/maps/satellite/style.json?key=".concat(y):"data:application/json,".concat(encodeURIComponent(f(!1))),enabled:!0},{id:"topo",label:"Topo",styleUrl:x?"https://api.maptiler.com/maps/topo-v2/style.json?key=".concat(y):"https://basemaps.cartocdn.com/gl/voyager-gl-style/style.json",enabled:!0}],_=[{id:"statewide_hydrology",label:"Statewide hydrology",group:"MRI Overlays",defaultOn:!0,source:{id:"statewide-hydrology-source",type:"geojson",data:"https://hydro.nationalmap.gov/arcgis/rest/services/nhd/MapServer/2/query?where=1%3D1&geometry=-116.2,44.2,-104,49.2&geometryType=esriGeometryEnvelope&inSR=4326&spatialRel=esriSpatialRelIntersects&outFields=GNIS_NAME&returnGeometry=true&geometryPrecision=4&maxAllowableOffset=0.005&f=geojson"},layers:["statewide-hydrology-line"],locked:!0},{id:"public_federal",label:"Federal",group:"Public Lands",defaultOn:!1,source:{id:"public-lands-federal-source",type:"raster",tiles:["https://gis.blm.gov/arcgis/rest/services/lands/BLM_Natl_SMA_Cached_without_PriUnk/MapServer/tile/{z}/{y}/{x}"],tileSize:256,attribution:"BLM Surface Management Agency"},layers:["public-lands-federal-layer"],minZoomNote:"Visible at zoom 7+"},{id:"public_state",label:"State",group:"Public Lands",defaultOn:!1,source:{id:"public-lands-state-source",type:"none"},layers:[],comingSoon:!0},{id:"access_fishing_sites",label:"Fishing Access Sites (MT FWP)",group:"Access",defaultOn:!1,source:{id:"access-fishing-sites-source",type:"geojson",data:"https://fwp-gis.mt.gov/arcgis/rest/services/fwplnd/fwpLands/MapServer/1/query?where=1%3D1&outFields=NAME&returnGeometry=true&f=geojson"},layers:["access-fishing-sites-layer"]},{id:"mri_river_lines",label:"Rivers",group:"MRI Overlays",defaultOn:!0,source:{id:"selected-river-source",type:"geojson"},layers:["rivers-main","rivers-hit"]},{id:"mri_selected_highlight",label:"Selected river highlight",group:"MRI Overlays",defaultOn:!0,source:{id:"selected-river-source",type:"geojson"},layers:["rivers-halo","rivers-casing"]},{id:"mri_river_markers",label:"River markers",group:"MRI Overlays",defaultOn:!0,source:{id:"rivers-source",type:"geojson"},layers:["rivers-unclustered","rivers-selected-halo","rivers-selected-core"],locked:!0},{id:"mri_score_coloring",label:"Score coloring",group:"MRI Overlays",defaultOn:!1,source:{id:"rivers-source",type:"geojson"},layers:["rivers-unclustered"]},{id:"mri_labels",label:"Labels",group:"MRI Overlays",defaultOn:!0,source:{id:"basemap-style",type:"none"},layers:["selected-river-label"]},{id:"hydro_flow_magnitude",label:"Flow magnitude",group:"MRI Overlays",defaultOn:!1,source:{id:"rivers-source",type:"geojson"},layers:["hydro-flow-magnitude-layer"]},{id:"hydro_change_indicator",label:"48h change indicator",group:"MRI Overlays",defaultOn:!1,source:{id:"rivers-source",type:"geojson"},layers:["hydro-change-indicator-layer"]},{id:"hydro_temp_stress",label:"Temp stress flag",group:"MRI Overlays",defaultOn:!1,source:{id:"rivers-source",type:"geojson"},layers:["hydro-temp-stress-layer"]}],j="mri.layers.v2",w=null!==(i=null===(l=b.find(e=>e.defaultOn))||void 0===l?void 0:l.id)&&void 0!==i?i:"dark";function L(){return _.reduce((e,t)=>(e[t.id]=t.defaultOn,e),{})}let N=["Public Lands","Access","MRI Overlays"],S="montana-river-map-labels";function M(){let e=localStorage.getItem(S);return null===e||"true"===e}function k(e){let{map:t}=e,[r,l]=(0,s.useState)(M);return(0,s.useEffect)(()=>{var e;if(!t)return;let l=null===(e=t.getStyle())||void 0===e?void 0:e.layers;if(Array.isArray(l))for(let e of l)e.id.toLowerCase().includes("label")&&t.setLayoutProperty(e.id,"visibility",r?"visible":"none")},[t,r]),(0,a.jsx)("div",{className:"pointer-events-none absolute right-3 bottom-3 z-30 flex flex-col gap-2 rounded-lg p-1.5",children:(0,a.jsxs)("label",{className:"pointer-events-auto flex items-center gap-2 px-2 py-1.5 rounded cursor-pointer hover:bg-white/5 text-sm text-slate-200 bg-slate-900/90 backdrop-blur-sm border border-white/10",children:[(0,a.jsx)("input",{type:"checkbox",checked:r,onChange:()=>{let e=!r;l(e),localStorage.setItem(S,String(e))},className:"rounded border-slate-500 bg-slate-800 text-sky-500"}),"Labels"]})})}let F=[-110.9,46.9],R={HOT:v.warning,GOOD:v.good,FAIR:v.fair,TOUGH:v.tough},O="rivers-source",C="rivers-unclustered",z="rivers-selected-halo",E="rivers-selected-core",T="selected-river-source",A="river-labels-source",P="rivers-hit",I="rivers-halo",G="rivers-casing",D="rivers-main",H="river-labels",B="statewide-hydrology-source",U="statewide-hydrology-line",W="public-lands-federal-source",Y="public-lands-federal-layer",Z="access-fishing-sites-source",q="access-fishing-sites-layer",V="hydro-flow-magnitude-layer",J="hydro-change-indicator-layer",X="hydro-temp-stress-layer",K="river_id",Q=["dark","light","topo","satellite","satellite-labels"],$={hybrid:{rasterLayers:["satellite"],labelLayers:["satellite-labels"]},satellite:{rasterLayers:["satellite"],labelLayers:[]},topo:{rasterLayers:["topo"],labelLayers:[]},light:{rasterLayers:["light"],labelLayers:[]},dark:{rasterLayers:["dark"],labelLayers:[]}},ee={version:8,name:"mri-base",sources:{},layers:[],glyphs:"https://demotiles.maplibre.org/font/{fontstack}/{range}.pbf"};function et(){return["to-string",["coalesce",["get",K],["get","river_uuid"],["get","riverId"],["get","id"],""]]}function er(e){var t,r,l,i;if(!e)return null;let a=null!==(i=null!==(l=null!==(r=null!==(t=e[K])&&void 0!==t?t:e.river_uuid)&&void 0!==r?r:e.riverId)&&void 0!==l?l:e.id)&&void 0!==i?i:null;if(null==a)return null;let s=String(a).trim();return s.length>0?s:null}function el(e,t){var r;for(let t of(!function(e){let t=function(t,r,l){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;e.getSource(t)||e.addSource(t,{type:"raster",tiles:r,tileSize:256,attribution:l}),e.getLayer(t)||e.addLayer({id:t,type:"raster",source:t,layout:{visibility:"none"},paint:{"raster-opacity":i}})};t("satellite",["https://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}"],"Esri, Maxar, Earthstar Geographics"),t("satellite-labels",["https://services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Boundaries_and_Places/MapServer/tile/{z}/{y}/{x}"],"Esri",.92),t("dark",["https://a.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}.png"],"CARTO"),t("light",["https://a.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png"],"CARTO"),t("topo",["https://a.tile.opentopomap.org/{z}/{x}/{y}.png"],"OpenTopoMap")}(e),Q))e.getLayer(t)&&e.setLayoutProperty(t,"visibility","none");let l=null!==(r=$[t])&&void 0!==r?r:$.hybrid;for(let t of[...l.rasterLayers,...l.labelLayers])e.getLayer(t)&&e.setLayoutProperty(t,"visibility","visible");try{for(let t of Q)e.getLayer(t)&&e.moveLayer(t)}catch(e){}!function(e){var t,r;let l=(null!==(t=e.getStyle().layers)&&void 0!==t?t:[]).filter(e=>"raster"===e.type),i=0;for(let t of l){let l=null!==(r=t.id)&&void 0!==r?r:"",a=l.toLowerCase();if(!a.includes("label")&&!a.includes("reference")&&!a.includes("boundaries")&&l!==Y)try{e.setPaintProperty(l,"raster-saturation",-.15),e.setPaintProperty(l,"raster-brightness-min",.05),e.setPaintProperty(l,"raster-brightness-max",.95),i+=1}catch(e){}}0===i&&l.length>0&&console.log("MAP RASTER LAYERS",l.map(e=>({id:e.id,type:e.type})))}(e)}function ei(e,t){if(!e||!t)return null;let r=String(t);return function(e){let t=1/0,r=1/0,l=-1/0,i=-1/0,a=!1,s=e=>{let s=e[0],n=e[1];Number.isFinite(s)&&Number.isFinite(n)&&(t=Math.min(t,s),r=Math.min(r,n),l=Math.max(l,s),i=Math.max(i,n),a=!0)};for(let t of e){let e=t.geometry;if(e){if("LineString"===e.type){for(let t of e.coordinates)s(t);continue}if("MultiLineString"===e.type)for(let t of e.coordinates)for(let e of t)s(e)}}return a?[t,r,l,i]:null}((()=>{if("FeatureCollection"===e.type)return e.features.filter(e=>!!(null==e?void 0:e.geometry)).filter(e=>{var t;return er(null!==(t=e.properties)&&void 0!==t?t:null)===r});if("Feature"===e.type){var t;return e.geometry&&er(null!==(t=e.properties)&&void 0!==t?t:null)===r?[e]:[]}return"LineString"===e.type||"MultiLineString"===e.type?[{type:"Feature",geometry:e,properties:{river_id:r}}]:[]})())}function ea(e){let t=[];for(let c of e){var r,l,i,a,s,n,o;let e=null!==(r=c.lat)&&void 0!==r?r:c.latitude,d=null!==(l=c.lng)&&void 0!==l?l:c.longitude,u=null!=e&&null!=d?[d,e]:g[c.river_id];u&&t.push({type:"Feature",geometry:{type:"Point",coordinates:u},properties:{river_id:c.river_id,river_name:c.river_name,bite_tier:null!==(i=c.bite_tier)&&void 0!==i?i:null,fishability_score:null!==(a=c.fishability_score_calc)&&void 0!==a?a:null,flow_ratio_calc:null!==(s=c.flow_ratio_calc)&&void 0!==s?s:null,change_48h_pct_calc:null!==(n=c.change_48h_pct_calc)&&void 0!==n?n:null,water_temp_f:null!==(o=c.water_temp_f)&&void 0!==o?o:null}})}return{type:"FeatureCollection",features:t}}function es(e,t){var r;let l=ea(t),i=e.getSource(O);if(!i){e.addSource(O,{type:"geojson",data:l,cluster:!1,generateId:!0});return}null===(r=i.setData)||void 0===r||r.call(i,l)}function en(e){e.getLayer(C)||e.addLayer({id:C,type:"circle",source:O,filter:["==",["geometry-type"],"Point"],paint:{"circle-color":["case",["==",["get","bite_tier"],"HOT"],R.HOT,["==",["get","bite_tier"],"GOOD"],R.GOOD,["==",["get","bite_tier"],"FAIR"],R.FAIR,["==",["get","bite_tier"],"TOUGH"],R.TOUGH,"#94a3b8"],"circle-radius":["case",["boolean",["feature-state","hover"],!1],8,6],"circle-stroke-color":"rgba(255,255,255,0.92)","circle-stroke-width":["case",["boolean",["feature-state","hover"],!1],2.5,2],"circle-opacity":.95}}),e.getLayer(z)||e.addLayer({id:z,type:"circle",source:O,filter:["==",["get","river_id"],"__none__"],paint:{"circle-color":"rgba(56, 189, 248, 0.30)","circle-radius":15}}),e.getLayer(E)||e.addLayer({id:E,type:"circle",source:O,filter:["==",["get","river_id"],"__none__"],paint:{"circle-color":"rgba(255,255,255,0.98)","circle-radius":6,"circle-stroke-color":"rgba(56, 189, 248, 0.98)","circle-stroke-width":2}})}function eo(e,t,r,l){let i=null!=t?t:"__none__",a=r?"visible":"none";for(let t of[C,z,E])e.getLayer(t)&&e.setLayoutProperty(t,"visibility",a);if(e.getLayer(z)&&e.setFilter(z,["==",["get","river_id"],i]),e.getLayer(E)&&e.setFilter(E,["==",["get","river_id"],i]),!e.getLayer(C))return;let s=l?["case",["==",["get","bite_tier"],"HOT"],R.HOT,["==",["get","bite_tier"],"GOOD"],R.GOOD,["==",["get","bite_tier"],"FAIR"],R.FAIR,["==",["get","bite_tier"],"TOUGH"],R.TOUGH,"#94a3b8"]:"#94a3b8";e.setPaintProperty(C,"circle-color",s),e.setPaintProperty(C,"circle-opacity",t?["case",["==",["get","river_id"],t],.95,.38]:.95)}function ec(e){let t=new Map,r=e=>e.length,l=(e,l)=>{var i,a,s,n;let o=String(null!==(n=null!==(s=null!==(a=null!==(i=e.river_id)&&void 0!==i?i:e.river_uuid)&&void 0!==a?a:e.riverId)&&void 0!==s?s:e.id)&&void 0!==n?n:"").trim();if(!o||!(null==l?void 0:l.length))return;let c=t.get(o);(!c||r(c.geometry.coordinates)<r(l))&&t.set(o,{type:"Feature",properties:e,geometry:{type:"LineString",coordinates:l}})},i=e=>{var t;if(!e.geometry)return;let r={...null!==(t=e.properties)&&void 0!==t?t:{}};if("LineString"===e.geometry.type){l(r,e.geometry.coordinates);return}if("MultiLineString"===e.geometry.type)for(let t of e.geometry.coordinates)l(r,t)};if("FeatureCollection"===e.type)for(let t of e.features)i(t);else"Feature"===e.type?i(e):"LineString"===e.type?i({type:"Feature",properties:{},geometry:e}):"MultiLineString"===e.type&&i({type:"Feature",properties:{},geometry:e});return{type:"FeatureCollection",features:Array.from(t.values())}}function ed(e,t,r,l,i,a,s){var n,o,c;let d=i&&a;if(!t||!i&&!d){e.getLayer(H)&&e.removeLayer(H),e.getLayer(P)&&e.removeLayer(P),e.getLayer(D)&&e.removeLayer(D),e.getLayer(G)&&e.removeLayer(G),e.getLayer(I)&&e.removeLayer(I),e.getSource(A)&&e.removeSource(A),e.getSource(T)&&e.removeSource(T);return}let u=t?"FeatureCollection"===t.type||"Feature"===t.type?t:"LineString"===t.type||"MultiLineString"===t.type?{type:"Feature",properties:{},geometry:t}:t:null;if(!u)return;let m=function(e,t,r){if(!r&&!t)return e;if("Feature"===e.type){var l;let i={...null!==(l=e.properties)&&void 0!==l?l:{}},a=null!=i.river_id||null!=i.river_uuid||null!=i.riverId||null!=i.id;return{...e,properties:{...i,...!a&&t?{river_id:t}:{},...r?{name:r,river_name:r}:{}}}}return"FeatureCollection"===e.type?{...e,features:e.features.map(e=>({...e,properties:(()=>{var l;let i={...null!==(l=e.properties)&&void 0!==l?l:{}},a=null!=i.river_id||null!=i.river_uuid||null!=i.riverId||null!=i.id;return{...i,...!a&&t?{river_id:t}:{},...r?{name:r,river_name:r}:{}}})()}))}:{type:"Feature",properties:{...t?{river_id:t}:{},...r?{name:r,river_name:r}:{}},geometry:e}}(u,r,l),p=r?String(r):"",h=function(e){let t=e?String(e):"";return t?["==",et(),t]:["==",["literal",1],["literal",0]]}(p),g=["==",["literal",p],""],y=["==",et(),p],x=e.getSource(T);if(x?null===(n=x.setData)||void 0===n||n.call(x,m):e.addSource(T,{type:"geojson",data:m}),d&&!e.getLayer(I)?e.addLayer({id:I,type:"line",source:T,filter:h,layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"rgba(255,255,255,0.25)","line-width":7,"line-blur":.5,"line-opacity":1}}):!d&&e.getLayer(I)&&e.removeLayer(I),d&&!e.getLayer(G)?e.addLayer({id:G,type:"line",source:T,filter:h,layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"rgba(0,0,0,0.35)","line-width":5,"line-opacity":1}}):!d&&e.getLayer(G)&&e.removeLayer(G),i&&!e.getLayer(D)?e.addLayer({id:D,type:"line",source:T,minzoom:4,maxzoom:24,layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":["case",y,v.riverSelected,v.riverBase],"line-width":["interpolate",["linear"],["zoom"],5,["case",y,3.1,2.6],7,["case",y,3.9,3.2],9,["case",y,5,4.2],11,["case",y,6.3,5.4]],"line-opacity":["case",g,.75,y,.95,.35]}}):!i&&e.getLayer(D)&&e.removeLayer(D),i&&!e.getLayer(P)?e.addLayer({id:P,type:"line",source:T,minzoom:4,maxzoom:24,layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"rgba(0,0,0,0)","line-width":["interpolate",["linear"],["zoom"],5,16,7,18,9,22,11,26],"line-opacity":0}}):!i&&e.getLayer(P)&&e.removeLayer(P),e.getLayer(I)&&e.setFilter(I,h),e.getLayer(G)&&e.setFilter(G,h),e.getLayer(D)&&(e.setPaintProperty(D,"line-color",["case",y,v.riverSelected,v.riverBase]),e.setPaintProperty(D,"line-width",["interpolate",["linear"],["zoom"],5,["case",y,3.1,2.6],7,["case",y,3.9,3.2],9,["case",y,5,4.2],11,["case",y,6.3,5.4]]),e.setPaintProperty(D,"line-opacity",["case",g,.75,y,.95,.35])),s&&!e.getLayer(H)){let t=ec(m),r=e.getSource(A);r?null===(o=r.setData)||void 0===o||o.call(r,t):e.addSource(A,{type:"geojson",data:t}),e.addLayer({id:H,type:"symbol",source:A,minzoom:7,layout:{"symbol-placement":"line","symbol-spacing":500,"text-field":["coalesce",["get","river_name"],["get","name"],""],"text-size":["interpolate",["linear"],["zoom"],7,11,10,13,12,15],"text-font":["Open Sans Semibold","Arial Unicode MS Bold"],"text-allow-overlap":!1,"text-ignore-placement":!1,"text-padding":2,"text-max-angle":30,"text-letter-spacing":.02},paint:{"text-color":"rgba(203,213,225,0.88)","text-opacity":["interpolate",["linear"],["zoom"],7,0,8,.6,10,.82],"text-halo-color":"rgba(255,255,255,0.7)","text-halo-width":1,"text-halo-blur":.5}})}else if(s&&e.getLayer(H)){let t=ec(m),r=e.getSource(A);null==r||null===(c=r.setData)||void 0===c||c.call(r,t)}else!s&&e.getLayer(H)&&(e.removeLayer(H),e.getSource(A)&&e.removeSource(A));try{e.getLayer(U)&&e.getLayer(I)&&e.moveLayer(I),e.getLayer(I)&&e.getLayer(C)&&e.moveLayer(I,C),e.getLayer(G)&&e.getLayer(C)&&e.moveLayer(G,C),e.getLayer(D)&&e.getLayer(C)&&e.moveLayer(D,C),e.getLayer(P)&&e.getLayer(C)&&e.moveLayer(P,C),e.getLayer(H)&&e.getLayer(C)&&e.moveLayer(H,C),e.getLayer(C)&&e.moveLayer(C),e.getLayer(z)&&e.moveLayer(z),e.getLayer(E)&&e.moveLayer(E)}catch(e){}}function eu(e,t){if(t){e.getSource(B)||e.addSource(B,{type:"geojson",data:"https://hydro.nationalmap.gov/arcgis/rest/services/nhd/MapServer/2/query?where=1%3D1&geometry=-116.2,44.2,-104,49.2&geometryType=esriGeometryEnvelope&inSR=4326&spatialRel=esriSpatialRelIntersects&outFields=GNIS_NAME&returnGeometry=true&geometryPrecision=4&maxAllowableOffset=0.005&f=geojson"}),e.getLayer(U)||e.addLayer({id:U,type:"line",source:B,paint:{"line-color":"#2C3E44","line-width":["interpolate",["linear"],["zoom"],5,.35,8,.55,11,.9],"line-opacity":.7}});try{e.getLayer(I)?e.moveLayer(U,I):e.getLayer(C)&&e.moveLayer(U,C)}catch(e){}return}e.getLayer(U)&&e.removeLayer(U)}function em(e,t){if(t){e.getSource(W)||e.addSource(W,{type:"raster",tiles:["https://gis.blm.gov/arcgis/rest/services/lands/BLM_Natl_SMA_Cached_without_PriUnk/MapServer/tile/{z}/{y}/{x}"],tileSize:256,attribution:"BLM Surface Management Agency"}),e.getLayer(Y)||e.addLayer({id:Y,type:"raster",source:W,minzoom:7,paint:{"raster-opacity":.24,"raster-saturation":-.55,"raster-contrast":-.2,"raster-brightness-min":.15,"raster-brightness-max":.82}});return}e.getLayer(Y)&&e.removeLayer(Y)}function ep(e,t){if(t){e.getSource(Z)||e.addSource(Z,{type:"geojson",data:"https://fwp-gis.mt.gov/arcgis/rest/services/fwplnd/fwpLands/MapServer/1/query?where=1%3D1&outFields=NAME&returnGeometry=true&f=geojson"}),e.getLayer(q)||e.addLayer({id:q,type:"circle",source:Z,paint:{"circle-color":v.riverSelected,"circle-radius":4,"circle-stroke-color":"#e2e8f0","circle-stroke-width":1.25,"circle-opacity":.95}});return}e.getLayer(q)&&e.removeLayer(q)}function eh(e,t,r,l){t?e.getLayer(V)||e.addLayer({id:V,type:"circle",source:O,filter:["==",["geometry-type"],"Point"],paint:{"circle-color":["interpolate",["linear"],["coalesce",["get","flow_ratio_calc"],1],.4,v.riverSelected,.8,v.good,1,v.fair,1.5,v.warning,2,v.warning],"circle-radius":["interpolate",["linear"],["zoom"],5,2.5,9,4.2,12,5.2],"circle-opacity":.8}}):e.getLayer(V)&&e.removeLayer(V),r?e.getLayer(J)||e.addLayer({id:J,type:"symbol",source:O,filter:["==",["geometry-type"],"Point"],layout:{"text-field":["case",[">",["coalesce",["get","change_48h_pct_calc"],0],12],"▲",["<",["coalesce",["get","change_48h_pct_calc"],0],-12],"▼","•"],"text-size":["interpolate",["linear"],["zoom"],6,9,10,12],"text-offset":[0,1.3]},paint:{"text-color":["case",[">",["coalesce",["get","change_48h_pct_calc"],0],12],v.good,["<",["coalesce",["get","change_48h_pct_calc"],0],-12],v.warning,"#94a3b8"],"text-halo-color":"rgba(15,23,42,0.9)","text-halo-width":1}}):e.getLayer(J)&&e.removeLayer(J),l?e.getLayer(X)||e.addLayer({id:X,type:"circle",source:O,filter:["all",["==",["geometry-type"],"Point"],[">=",["coalesce",["get","water_temp_f"],0],67]],paint:{"circle-color":v.warning,"circle-radius":["interpolate",["linear"],["zoom"],6,5,10,7.5],"circle-stroke-color":"rgba(255,255,255,0.95)","circle-stroke-width":1.2,"circle-opacity":.8}}):e.getLayer(X)&&e.removeLayer(X);try{e.getLayer(V)&&e.getLayer(C)&&e.moveLayer(V,C),e.getLayer(J)&&e.getLayer(C)&&e.moveLayer(J,C),e.getLayer(X)&&e.getLayer(C)&&e.moveLayer(X,C)}catch(e){}}function eg(e,t){var r;let l=e.getStyle(),i=t?"visible":"none";for(let t of null!==(r=l.layers)&&void 0!==r?r:[]){if(!t.id)continue;let r=t.id.toLowerCase();if(r.includes("label")||r.includes("place")||r.includes("poi"))try{e.setLayoutProperty(t.id,"visibility",i)}catch(e){}}}function ev(e){let{rivers:t,selectedRiver:r,selectedRiverName:l,selectedRiverId:i,selectedRiverGeojson:n,riverLinesGeojson:c,basemap:d="hybrid",layerState:u,rightPanelOpen:m=!1,drawerState:p="mid",onSelectRiver:h,className:v,onMapReady:y}=e,x=null!=u?u:L(),f=(0,s.useRef)(null),b=(0,s.useRef)(null),_=(0,s.useRef)(t),j=(0,s.useRef)(h),w=(0,s.useRef)(l),N=(0,s.useRef)(i),S=(0,s.useRef)(n),M=(0,s.useRef)(null!=c?c:null),R=(0,s.useRef)(d),T=(0,s.useRef)(x),A=(0,s.useRef)(null),H=(0,s.useRef)(null),B=(0,s.useRef)(null),[U,W]=(0,s.useState)(!1);_.current=t,j.current=h,w.current=l,N.current=i,S.current=n,M.current=null!=c?c:null,R.current=d,T.current=x;let Y=(0,s.useCallback)(e=>{var t;el(e,R.current),es(e,_.current),en(e),eo(e,N.current,!0,T.current.mri_score_coloring),ed(e,null!==(t=M.current)&&void 0!==t?t:S.current,N.current,w.current,T.current.mri_river_lines,T.current.mri_selected_highlight,T.current.mri_labels),eu(e,T.current.statewide_hydrology),em(e,T.current.public_federal),ep(e,T.current.access_fishing_sites),eh(e,T.current.hydro_flow_magnitude,T.current.hydro_change_indicator,T.current.hydro_temp_stress),eg(e,T.current.mri_labels)},[]),Z=(0,s.useCallback)(()=>{if(!f.current)return;let e=new(o()).Map({container:f.current,style:ee,center:F,zoom:5.2,pitch:22,bearing:-5});e.addControl(new(o()).NavigationControl,"top-right"),b.current=e,e.on("load",()=>{var t;W(!0),null==y||y(e),Y(e),console.log("MAP STYLE LAYERS",(null!==(t=e.getStyle().layers)&&void 0!==t?t:[]).map(e=>({id:e.id,type:e.type}))),console.log("RIVER/STATION LAYERS",{riverHit:P,riverMain:D,riverCasing:G,riverHalo:I,stationLayers:[C,z,E]}),e.resize()}),e.__mriHandlers||(e.__mriHandlers=!0,e.on("click",C,e=>{var t,r;e.originalEvent&&"cancelBubble"in e.originalEvent&&(e.originalEvent.cancelBubble=!0);let l=null===(t=e.features)||void 0===t?void 0:t[0],i=null==l?void 0:null===(r=l.properties)||void 0===r?void 0:r.river_id;if(!i)return;let a=_.current.find(e=>e.river_id===i);a&&j.current(a)}),e.on("click",P,t=>{var r,l,i,a;if(!T.current.mri_river_lines||e.queryRenderedFeatures(t.point,{layers:[C,z,E]}).length>0)return;let s=null===(r=t.features)||void 0===r?void 0:r[0];console.log("river click props",null==s?void 0:s.properties);let n=null!==(a=null!==(i=er(null!==(l=null==s?void 0:s.properties)&&void 0!==l?l:null))&&void 0!==i?i:N.current)&&void 0!==a?a:void 0;if(!n)return;let o=_.current.find(e=>e.river_id===n||e.slug===n);o&&(H.current=null,j.current(o))}),e.on("mouseenter",P,()=>{e.getCanvas().style.cursor="pointer"}),e.on("mouseleave",P,()=>{e.getCanvas().style.cursor=""}),e.on("mousemove",C,t=>{var r;e.getCanvas().style.cursor="pointer";let l=null===(r=t.features)||void 0===r?void 0:r[0],i=null==l?void 0:l.id;if(null!=i){if(null!=A.current&&A.current!==i)try{e.setFeatureState({source:O,id:A.current},{hover:!1})}catch(e){}A.current=i;try{e.setFeatureState({source:O,id:i},{hover:!0})}catch(e){}}}),e.on("mouseleave",C,()=>{if(e.getCanvas().style.cursor="",null!=A.current)try{e.setFeatureState({source:O,id:A.current},{hover:!1})}catch(e){}A.current=null}))},[y,Y]);(0,s.useEffect)(()=>(Z(),()=>{var e;null===(e=b.current)||void 0===e||e.remove(),b.current=null,H.current=null}),[Z]),(0,s.useEffect)(()=>{let e=b.current;if(!e||!f.current)return;let t=()=>e.resize();window.addEventListener("resize",t);let r=new ResizeObserver(()=>e.resize());return r.observe(f.current),()=>{window.removeEventListener("resize",t),r.disconnect()}},[U]);let q=t.map(e=>e.river_id).join(",");return(0,s.useEffect)(()=>{let e=b.current;if(e&&U&&("function"!=typeof e.isStyleLoaded||e.isStyleLoaded())&&(es(e,t),en(e),eo(e,i,!0,x.mri_score_coloring),!i)){let r=ea(t);if(r.features.length){let t=new(o()).LngLatBounds(r.features[0].geometry.coordinates,r.features[0].geometry.coordinates);for(let e of r.features)t.extend(e.geometry.coordinates);e.fitBounds(t,{padding:60,duration:450})}}},[q,U,t,i,x.mri_score_coloring]),(0,s.useEffect)(()=>{var e,t;let a=b.current;if(!a||!U||"function"==typeof a.isStyleLoaded&&!a.isStyleLoaded())return;if(console.log("SELECTED RIVER STYLE UPDATE",i),eo(a,i,!0,x.mri_score_coloring),ed(a,null!=c?c:n,i,l,x.mri_river_lines,x.mri_selected_highlight,x.mri_labels),!i){H.current=null,B.current=null;return}let s="".concat(i,"|").concat(m?1:0,"|").concat(p);if(B.current===s)return;B.current=s,H.current=i;let o="expanded"===p?360:"mid"===p?220:120,d=(null==r?void 0:r.lat)!=null&&(null==r?void 0:r.lng)!=null?[r.lng,r.lat]:g[i],u=null!==(t=null!==(e=ei(c,i))&&void 0!==e?e:ei(n,i))&&void 0!==t?t:n?function(e){let t=[],r=e=>{if("Point"===e.type)t.push(e.coordinates);else if("LineString"===e.type)for(let r of e.coordinates)t.push(r);else if("MultiLineString"===e.type)for(let r of e.coordinates)for(let e of r)t.push(e);else if("Polygon"===e.type)for(let r of e.coordinates)for(let e of r)t.push(e);else if("MultiPoint"===e.type)for(let r of e.coordinates)t.push(r)};if("geometry"in e&&e.geometry)r(e.geometry);else if("coordinates"in e)r(e);else if("features"in e)for(let t of e.features)t.geometry&&r(t.geometry);if(!t.length)return null;let l=t.map(e=>e[0]),i=t.map(e=>e[1]);return[Math.min(...l),Math.min(...i),Math.max(...l),Math.max(...i)]}(n):null;if(u&&a.fitBounds){a.fitBounds([[u[0],u[1]],[u[2],u[3]]],{padding:{top:80,left:40,right:m?420:40,bottom:o},duration:450,maxZoom:11,essential:!0});return}d&&a.flyTo({center:d,zoom:9.5,duration:450,curve:1.5,essential:!0})},[i,n,c,r,x.mri_river_lines,x.mri_selected_highlight,x.mri_labels,x.mri_score_coloring,m,p,U]),(0,s.useEffect)(()=>{let e=b.current;e&&U&&("function"!=typeof e.isStyleLoaded||e.isStyleLoaded())&&el(e,d)},[d,U]),(0,s.useEffect)(()=>{let e=b.current;e&&U&&("function"!=typeof e.isStyleLoaded||e.isStyleLoaded())&&(eu(e,x.statewide_hydrology),em(e,x.public_federal),ep(e,x.access_fishing_sites),eh(e,x.hydro_flow_magnitude,x.hydro_change_indicator,x.hydro_temp_stress),eg(e,x.mri_labels))},[U,x.statewide_hydrology,x.public_federal,x.access_fishing_sites,x.hydro_flow_magnitude,x.hydro_change_indicator,x.hydro_temp_stress,x.mri_labels]),(0,s.useEffect)(()=>{let e=b.current;if(!e||!U)return;let t=()=>{Y(e)};return e.on("load",t),()=>{e.off("load",t)}},[U,Y]),(0,a.jsx)("div",{id:"map",ref:f,className:"absolute inset-0 h-full w-full min-h-0 [&_.maplibregl-marker]:cursor-pointer ".concat(null!=v?v:"").trim(),style:{position:"absolute",inset:0,height:"100%",width:"100%",minHeight:320},"aria-label":"Montana river map",children:U&&b.current&&(0,a.jsx)(k,{map:b.current})})}var ey=r(3053);let ex="https://relkyvqwmfbmzzlqypmu.supabase.co",ef="sb_publishable_PxejFrRRvhrHai_FtjAGoA_rlM9S9_e",eb=ex&&ef?(0,ey.eI)(ex,ef):null;async function e_(e){var t;if(!eb)return null;let{data:r,error:l}=await eb.from("river_geoms").select("geom").eq("river_id",e).single();return l||!r?null:null!==(t=r.geom)&&void 0!==t?t:null}async function ej(e){if(!e||!eb)return null;let{data:t,error:r}=await eb.rpc("get_river_geojson_by_slug",{p_slug:e});return r?(console.error("[fetchRiverGeojsonBrowser] rpc error:",r),null):null!=t?t:null}function ew(e,t,r){return Math.max(t,Math.min(r,e))}function eL(e){return null==e||Number.isNaN(e)?"→":e>5?"↑":e<-5?"↓":"→"}function eN(e){let{tier:t}=e,r="Good"===t||"HOT"===t||"GOOD"===t?v.good:"Fair"===t||"FAIR"===t?v.fair:v.tough;return(0,a.jsxs)("span",{className:"inline-flex items-center gap-2 text-xs font-semibold text-white/90",children:[(0,a.jsx)("span",{className:"h-2.5 w-2.5 rounded-full",style:{backgroundColor:r}}),"HOT"===t||"GOOD"===t?"Good":"FAIR"===t?"Fair":"TOUGH"===t?"Tough":null!=t?t:"—"]})}function eS(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return null==e||Number.isNaN(e)?"—":Number(e).toFixed(t)}function eM(e){if(!e)return"—";let t=new Date(e);return Number.isNaN(t.getTime())?"—":t.toLocaleString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0,timeZone:"America/Denver"})}function ek(e){var t,r,l,i,n,v,y,x;let{rivers:f,dateLabel:S=new Date().toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric",year:"numeric"})}=e,M={collapsed:.84,mid:.42,expanded:0},[k,F]=(0,s.useState)(""),[R,O]=(0,s.useState)("All"),[C,z]=(0,s.useState)(null),[E,T]=(0,s.useState)("mid"),[A,P]=(0,s.useState)(M.mid),[I,G]=(0,s.useState)(!1),D=(0,s.useRef)(null),[H,B]=(0,s.useState)(null),[U,W]=(0,s.useState)(null),Y=(0,s.useRef)(null),[Z,q]=(0,s.useState)(!1),[V,J]=(0,s.useState)("none"),[X,K]=(0,s.useState)(!1),[Q,$]=(0,s.useState)(!1),[ee,et]=(0,s.useState)("hybrid"),[er,el]=(0,s.useState)(L()),ei=(0,s.useMemo)(()=>Object.fromEntries(b.map(e=>[e.id,e])),[]),ea=(0,s.useMemo)(()=>{let e=k.trim().toLowerCase();return(null!=f?f:[]).filter(t=>{var r,l;let i=!e||(null!==(r=t.river_name)&&void 0!==r?r:"").toLowerCase().includes(e)||(null!==(l=t.gauge_label)&&void 0!==l?l:"").toLowerCase().includes(e),a="HOT"===t.bite_tier||"GOOD"===t.bite_tier?"Good":"FAIR"===t.bite_tier?"Fair":"TOUGH"===t.bite_tier?"Tough":"";return i&&("All"===R||a===R)}).sort((e,t)=>{var r,l;return(null!==(r=t.fishability_score_calc)&&void 0!==r?r:-999)-(null!==(l=e.fishability_score_calc)&&void 0!==l?l:-999)})},[f,k,R]),es=(0,s.useMemo)(()=>{var e,t;return C&&null!==(t=null!==(e=ea.find(e=>e.river_id===C))&&void 0!==e?e:f.find(e=>e.river_id===C))&&void 0!==t?t:null},[ea,f,C]),en=(0,s.useMemo)(()=>(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Date,t=e.getMonth();return 11===t||t<=1?{season:"Winter",likelyBugs:"Midges, Blue-Winged Olives (low activity windows)",recommendedApproach:"Fish slow seams and tailouts with small nymphs or midge dries during warmest hours."}:t>=2&&t<=4?{season:"Spring",likelyBugs:"Skwala, Baetis, early caddis",recommendedApproach:"Target afternoon windows; mix dry-dropper with short nymph rigs as flows stabilize."}:t>=5&&t<=7?{season:"Summer",likelyBugs:"PMD, caddis, stoneflies, terrestrials",recommendedApproach:"Cover pocket water and banks with attractor dries, then switch to nymphs when surface slows."}:{season:"Fall",likelyBugs:"Baetis, mahogany duns, midges",recommendedApproach:"Fish midday hatches and focus on softer edges with emergers, small dries, and light nymph rigs."}})(),[]),eo=(0,s.useMemo)(()=>es?function(e){var t,r,l;let i=e.flow_ratio_calc,a=e.change_48h_pct_calc,s=e.water_temp_f,n=null!=e.wind_am_mph&&null!=e.wind_pm_mph?(e.wind_am_mph+e.wind_pm_mph)/2:null!==(r=null!==(t=e.wind_am_mph)&&void 0!==t?t:e.wind_pm_mph)&&void 0!==r?r:null,o=null==i||i<=0?null:Math.round(ew(30-14*Math.abs(Math.log2(i)),0,30));return{flowScore:o,stabilityScore:null==a?null:Math.round(ew(25-.8*Math.abs(a),0,25)),thermalScore:null==s?null:Math.round(ew(25-1.2*Math.abs(s-56),0,25)),windPenalty:null==n?null:Math.round(ew(1.2*n,0,20)),totalScore:null!==(l=e.fishability_score_calc)&&void 0!==l?l:null}}(es):null,[es]),ec=(0,s.useMemo)(()=>(function(e){if(!e)return"No current river read available.";let t=[],r=e.flow_ratio_calc,l=e.change_48h_pct_calc,i=e.wind_pm_mph,a=e.water_temp_f,s=e.precip_mm;if(null!=r&&(r>=.85&&r<=1.15?t.push("Flow near seasonal median."):r<.8?t.push("Flow below seasonal median."):r>1.2&&t.push("Flow above seasonal median.")),null!=l){let e=Math.abs(l);e<5?t.push("Stable."):e<=15?t.push("Moderate change."):t.push("Unstable.")}return(null!=i&&(i>30?t.push("High wind risk."):i>20&&t.push("Elevated PM wind.")),null!=a&&a>66&&t.push("Thermal stress possible."),null!=s&&s>=8&&t.push("Notable precipitation."),0===t.length)?"Conditions are mixed with limited signal from current telemetry.":t.join(" ")})(es),[es]),ed=(0,s.useMemo)(()=>"Summer"===en.season?"High":"Spring"===en.season||"Fall"===en.season?"Moderate":"Low",[en.season]),eu=(0,s.useMemo)(()=>{let e=0;for(let i of f){var t,r,l;let a=null!==(l=null!==(r=null!==(t=i.source_flow_observed_at)&&void 0!==t?t:i.source_temp_observed_at)&&void 0!==r?r:i.updated_at)&&void 0!==l?l:null;if(!a)continue;let s=new Date(a).getTime();!Number.isNaN(s)&&s>e&&(e=s)}return e>0?new Date(e).toISOString():null},[f]);function em(e){var t;let r="touches"in e?null===(t=e.touches[0])||void 0===t?void 0:t.clientY:e.clientY;if(null==r)return;D.current={startY:r,startSheetY:A},G(!0),document.body.style.userSelect="none";let l=e=>{var t;let r="touches"in e?null===(t=e.touches[0])||void 0===t?void 0:t.clientY:e.clientY;if(null==r||!D.current)return;let l=r-D.current.startY;P(Math.max(0,Math.min(1,D.current.startSheetY+l/320)))},i=()=>{D.current&&(D.current=null,G(!1),document.body.style.userSelect="",P(e=>{let t=["expanded","mid","collapsed"].reduce((t,r)=>Math.abs(e-M[r])<Math.abs(e-M[t])?r:t,"mid");return T(t),M[t]}),document.removeEventListener("pointermove",l),document.removeEventListener("pointerup",i),document.removeEventListener("touchmove",l),document.removeEventListener("touchend",i))};document.addEventListener("pointermove",l),document.addEventListener("pointerup",i),document.addEventListener("touchmove",l,{passive:!0}),document.addEventListener("touchend",i)}function ep(e,t){el(r=>({...r,[e]:t}))}function eh(e){J(t=>t===e?"none":e)}(0,s.useEffect)(()=>{let e=!1;return(async function(){var t,r,l;if(!C){B(null);return}let i=null!==(t=ea.find(e=>e.river_id===C))&&void 0!==t?t:f.find(e=>e.river_id===C),a=null!==(l=null!==(r=null==i?void 0:i.slug)&&void 0!==r?r:null==i?void 0:i.river_id)&&void 0!==l?l:C,s=await ej(a);if(e)return;if(s){B(s);return}let n=await e_(C);e||B(n?{type:"Feature",geometry:n,properties:{river_id:C}}:null)})().catch(()=>{e||B(null)}),()=>{e=!0}},[C,ea,f]),(0,s.useEffect)(()=>{let e=!1;return(async function(){let t=f.map(async e=>{var t;let r=null!==(t=e.slug)&&void 0!==t?t:e.river_id,l=await ej(r);return l?{river:e,gj:l}:null}),r=await Promise.all(t);if(e)return;let l=[];for(let e of r){var i,a,s;if(!(null==e?void 0:e.gj))continue;let t=e.river.river_id,r=e.river.river_name;if("FeatureCollection"===e.gj.type){for(let s of null!==(i=e.gj.features)&&void 0!==i?i:[])(null==s?void 0:s.geometry)&&l.push({type:"Feature",geometry:s.geometry,properties:{...null!==(a=s.properties)&&void 0!==a?a:{},river_id:t,river_name:r,name:r}});continue}if("Feature"===e.gj.type){e.gj.geometry&&l.push({type:"Feature",geometry:e.gj.geometry,properties:{...null!==(s=e.gj.properties)&&void 0!==s?s:{},river_id:t,river_name:r,name:r}});continue}("LineString"===e.gj.type||"MultiLineString"===e.gj.type)&&l.push({type:"Feature",geometry:e.gj,properties:{river_id:t,river_name:r,name:r}})}W({type:"FeatureCollection",features:l})})().catch(()=>{e||W({type:"FeatureCollection",features:[]})}),()=>{e=!0}},[f]),(0,s.useEffect)(()=>{if(es){q(!0);return}q(!1),K(!1)},[es]),(0,s.useEffect)(()=>{try{let e=localStorage.getItem(j);if(!e)return;let t=JSON.parse(e);if(t.basemap&&ei[t.basemap]&&et(t.basemap),t.layerState){let e={...L()};for(let r of _)"boolean"==typeof t.layerState[r.id]&&(e[r.id]=t.layerState[r.id]);el(e)}}catch(e){}},[ei]),(0,s.useEffect)(()=>{try{localStorage.setItem(j,JSON.stringify({basemap:ee,layerState:er}))}catch(e){}},[ee,er]);let eg="layers"===V,ey=(0,s.useMemo)(()=>N.map(e=>({group:e,layers:_.filter(t=>t.group===e)})),[]);return(0,a.jsxs)("div",{className:"relative h-[100dvh] w-full overflow-hidden bg-black",style:{position:"relative",height:"100dvh",width:"100%",overflow:"hidden",background:"#000"},children:[(0,a.jsx)("div",{className:"absolute inset-0 z-0",children:(0,a.jsx)(ev,{rivers:ea,selectedRiver:es,selectedRiverName:null!==(t=null==es?void 0:es.river_name)&&void 0!==t?t:null,selectedRiverId:C,selectedRiverGeojson:H,riverLinesGeojson:U,basemap:ee,layerState:er,rightPanelOpen:Z,drawerState:E,onSelectRiver:e=>z(e.river_id),className:"absolute inset-0",onMapReady:e=>{Y.current=e}})}),(0,a.jsx)("div",{className:"absolute left-3 top-3 z-20 hidden sm:block",children:(0,a.jsxs)("div",{className:"onx-glass w-[84px] overflow-hidden rounded-2xl",children:[(0,a.jsxs)("div",{className:"border-b border-white/10 px-3 py-3",children:[(0,a.jsx)("div",{className:"text-sm font-semibold leading-tight text-white",children:"MRI"}),(0,a.jsx)("div",{className:"text-[10px] leading-tight text-white/70",children:"Montana"})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-2 p-2",children:[(0,a.jsx)("button",{className:"onx-iconbtn",title:"Map",children:"\uD83D\uDDFA️"}),(0,a.jsx)("button",{className:"onx-iconbtn",title:"Rivers",children:"\uD83C\uDFA3"}),(0,a.jsx)("button",{className:"onx-iconbtn",title:"Reports",children:"\uD83D\uDCC4"})]})]})}),(0,a.jsxs)("div",{className:"absolute left-3 right-3 top-3 z-20 sm:left-[108px] sm:right-[240px]",children:[(0,a.jsxs)("div",{className:"onx-glass flex items-center gap-2 rounded-2xl px-3 py-2",children:[(0,a.jsxs)("div",{className:"hidden text-xs font-semibold text-white/80 sm:block",children:[S," • ",ea.length," rivers"]}),(0,a.jsxs)("div",{className:"hidden text-[11px] text-white/70 sm:block",children:["Last pull ",eM(eu)," MT"]}),(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsx)("input",{value:k,onChange:e=>F(e.target.value),placeholder:"Search rivers...",className:"w-full bg-transparent text-sm text-white placeholder:text-white/60 outline-none"})}),(0,a.jsx)("button",{className:"rounded-lg px-2 py-1 text-xs text-white/80 hover:text-white",onClick:()=>{F(""),O("All"),z(null)},children:"Reset"})]}),(0,a.jsx)("div",{className:"mt-2 flex flex-wrap gap-2",children:["All","Good","Fair","Tough"].map(e=>(0,a.jsx)("button",{onClick:()=>O(e),className:["h-9 rounded-full border px-3 text-sm font-medium backdrop-blur",R===e?"border-slate-200 bg-white/90 text-slate-900":"border-white/20 bg-slate-900/50 text-white hover:bg-slate-900/60"].join(" "),children:e},e))})]}),(0,a.jsxs)("div",{className:"absolute right-3 top-3 z-30 flex flex-col items-end gap-2",children:[(0,a.jsxs)("div",{className:"hidden flex-col gap-2 sm:flex",children:[(0,a.jsx)("button",{className:"onx-iconbtn ".concat(eg?"ring-2 ring-cyan-300/60":""),title:"Layers",onClick:()=>eh("layers"),children:(0,a.jsx)(c.Z,{size:18,strokeWidth:2.5})}),(0,a.jsx)("button",{className:"onx-iconbtn",title:"Zoom in",onClick:function(){var e,t;null===(t=Y.current)||void 0===t||null===(e=t.zoomIn)||void 0===e||e.call(t,{duration:180})},children:(0,a.jsx)(d.Z,{size:18,strokeWidth:2.5})}),(0,a.jsx)("button",{className:"onx-iconbtn",title:"Zoom out",onClick:function(){var e,t;null===(t=Y.current)||void 0===t||null===(e=t.zoomOut)||void 0===e||e.call(t,{duration:180})},children:(0,a.jsx)(u.Z,{size:18,strokeWidth:2.5})}),(0,a.jsx)("button",{className:"onx-iconbtn",title:"Fit to rivers",onClick:function(){let e=Y.current;if(!e||!ea.length)return;let t=new(o()).LngLatBounds,r=!1;for(let e of ea){var l,i;let a=null!==(l=e.lat)&&void 0!==l?l:e.latitude,s=null!==(i=e.lng)&&void 0!==i?i:e.longitude,n=null!=a&&null!=s?[s,a]:g[e.river_id];n&&(t.extend(n),r=!0)}r&&!t.isEmpty()&&e.fitBounds(t,{padding:60,duration:450,essential:!0})},children:(0,a.jsx)(m.Z,{size:18,strokeWidth:2.5})}),(0,a.jsx)("button",{className:"onx-iconbtn",title:"Recenter Montana",onClick:function(){var e,t;null===(t=Y.current)||void 0===t||null===(e=t.flyTo)||void 0===e||e.call(t,{center:[-110.9,46.9],zoom:5.2,duration:450,essential:!0})},children:(0,a.jsx)(p.Z,{size:18,strokeWidth:2.5})}),(0,a.jsx)("button",{className:"onx-iconbtn",title:"Toggle river list",onClick:()=>{let e="collapsed"===E?"mid":"collapsed";T(e),P(M[e])},children:(0,a.jsx)(h.Z,{size:18,strokeWidth:2.5})})]}),(0,a.jsx)("button",{className:"onx-iconbtn sm:hidden ".concat(eg?"ring-2 ring-cyan-300/60":""),title:"Layers",onClick:()=>eh("layers"),children:(0,a.jsx)(c.Z,{size:18,strokeWidth:2.5})}),(0,a.jsx)("div",{className:["w-[calc(100vw-1.5rem)] max-w-[360px] transition-all duration-200",eg?"translate-y-0 opacity-100":"pointer-events-none -translate-y-1 opacity-0"].join(" "),children:(0,a.jsx)("div",{className:"onx-card rounded-2xl border border-slate-200/70 p-4 shadow-xl",children:(0,a.jsxs)("div",{className:"max-h-[70vh] overflow-auto pr-1",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm font-semibold text-slate-900",children:"Layers"}),(0,a.jsx)("div",{className:"text-[11px] text-slate-500",children:"Map display controls"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("button",{className:"text-[11px] font-medium text-slate-500 hover:text-slate-700",onClick:function(){el(L()),et(w)},children:"Reset layers"}),(0,a.jsx)("button",{className:"text-[11px] font-medium text-slate-500 hover:text-slate-700",onClick:()=>J("none"),children:"Close"})]})]}),(0,a.jsx)("div",{className:"mt-4 text-[11px] font-semibold uppercase tracking-wide text-slate-500",children:"Basemap"}),(0,a.jsx)("div",{className:"mt-2 grid grid-cols-2 gap-2",children:b.map(e=>{let t=ee===e.id;return(0,a.jsxs)("button",{disabled:!e.enabled,className:["rounded-lg border px-2 py-1.5 text-xs font-medium",t?"border-slate-900 bg-slate-900 text-white":"border-slate-300 bg-white text-slate-700",e.enabled?"hover:bg-slate-50":"cursor-not-allowed opacity-55"].join(" "),onClick:()=>(function(e){let t=ei[e];(null==t?void 0:t.enabled)&&et(e)})(e.id),children:[(0,a.jsx)("div",{children:e.label}),!e.enabled&&e.comingSoon?(0,a.jsx)("div",{className:"text-[10px] text-slate-500",children:"Coming soon"}):null]},e.id)})}),(0,a.jsxs)("div",{className:"mt-4",children:[(0,a.jsx)("div",{className:"text-[11px] font-semibold uppercase tracking-wide text-slate-500",children:"Core Layers"}),(0,a.jsx)("div",{className:"mt-2 space-y-2 rounded-xl border border-slate-200 bg-slate-50/80 p-2.5 text-xs text-slate-700",children:ey.flatMap(e=>e.layers).filter(e=>"mri_river_lines"===e.id||"mri_selected_highlight"===e.id).map(e=>(0,a.jsxs)("label",{className:"flex items-start justify-between gap-3",children:[(0,a.jsx)("span",{className:"leading-tight",children:(0,a.jsx)("span",{className:"block",children:e.label})}),(0,a.jsx)("input",{type:"checkbox",checked:er[e.id],onChange:t=>ep(e.id,t.target.checked)})]},e.id))})]}),(0,a.jsx)("div",{className:"mt-4",children:(0,a.jsx)("button",{className:"w-full rounded-lg border border-slate-200 bg-white px-2.5 py-2 text-left text-xs font-medium text-slate-700 hover:bg-slate-50",onClick:()=>$(e=>!e),children:Q?"Hide Advanced Layers":"Advanced Layers"})}),Q?ey.map(e=>{let{group:t,layers:r}=e;return(0,a.jsxs)("div",{className:"mt-4",children:[(0,a.jsx)("div",{className:"text-[11px] font-semibold uppercase tracking-wide text-slate-500",children:t}),(0,a.jsx)("div",{className:"mt-2 space-y-2 rounded-xl border border-slate-200 bg-slate-50/80 p-2.5 text-xs text-slate-700",children:r.filter(e=>!e.locked&&"mri_river_lines"!==e.id&&"mri_selected_highlight"!==e.id).map(e=>{let t=er[e.id],r=!!e.comingSoon;return(0,a.jsxs)("label",{className:"flex items-start justify-between gap-3",children:[(0,a.jsxs)("span",{className:"leading-tight",children:[(0,a.jsx)("span",{className:"block",children:e.label}),e.minZoomNote?(0,a.jsx)("span",{className:"text-[10px] text-slate-500",children:e.minZoomNote}):null,e.comingSoon?(0,a.jsx)("span",{className:"text-[10px] text-slate-500",children:"Coming soon"}):null]}),(0,a.jsx)("input",{type:"checkbox",checked:t,disabled:r,onChange:t=>ep(e.id,t.target.checked)})]},e.id)})})]},t)}):null]})})})]}),(0,a.jsx)("div",{className:"absolute right-3 top-[120px] z-20 hidden w-[280px] sm:block",children:Z?(0,a.jsxs)("div",{className:"onx-card rounded-3xl p-8 shadow-[0_12px_28px_rgba(15,23,42,0.20)] transition-opacity duration-150",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("div",{className:"text-[11px] font-semibold uppercase tracking-wide text-slate-500",children:"River Detail"}),(0,a.jsx)("button",{className:"text-[11px] text-slate-500 hover:text-slate-700",onClick:()=>q(!1),children:"Collapse"})]}),es?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"mt-2 text-[15px] font-semibold text-slate-900",children:es.river_name}),(0,a.jsx)("div",{className:"text-xs text-slate-600",children:null!==(r=es.gauge_label)&&void 0!==r?r:""}),(0,a.jsxs)("div",{className:"mt-1 text-[11px] text-slate-500",children:["Updated ",eM(null!==(i=null!==(l=es.source_flow_observed_at)&&void 0!==l?l:es.source_temp_observed_at)&&void 0!==i?i:es.updated_at)," MT"]}),(0,a.jsxs)("div",{className:"mt-2 grid grid-cols-1 gap-0.5 text-[11px] text-slate-500",children:[(0,a.jsxs)("div",{children:["Flow source: ",eM(es.source_flow_observed_at)," MT"]}),(0,a.jsxs)("div",{children:["Temp source: ",eM(es.source_temp_observed_at)," MT"]}),(0,a.jsxs)("div",{children:["Weather/score: ",eM(es.updated_at)," MT"]})]}),(0,a.jsxs)("div",{className:"mt-3 text-[11px] leading-4 text-slate-500",style:{display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden"},children:[(0,a.jsx)("span",{className:"text-slate-600",children:"Today's Read: "}),ec]}),(0,a.jsx)("div",{className:"my-4 h-px bg-slate-200/80"}),(0,a.jsxs)("div",{className:"mt-5 grid grid-cols-2 gap-x-5 gap-y-6 text-xs",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-semibold leading-none tracking-[-0.02em] text-slate-900 text-[56px]",children:null!==(n=es.fishability_score_calc)&&void 0!==n?n:"—"}),(0,a.jsx)("div",{className:"mt-2",children:(0,a.jsx)(eN,{tier:"HOT"===es.bite_tier||"GOOD"===es.bite_tier?"Good":"FAIR"===es.bite_tier?"Fair":"TOUGH"===es.bite_tier?"Tough":void 0})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-[10px] text-slate-500",children:"Flow"}),(0,a.jsxs)("div",{className:"font-medium text-slate-900",children:[null!==(v=es.flow_cfs)&&void 0!==v?v:"—",(0,a.jsx)("span",{className:"ml-1 text-[11px] font-medium text-slate-500",children:eL(es.change_48h_pct_calc)})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-[10px] text-slate-500",children:"Temp"}),(0,a.jsx)("div",{className:"font-medium text-slate-900",children:null!=es.water_temp_f?"".concat(Number(es.water_temp_f).toFixed(1),"\xb0F"):"—"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-[10px] text-slate-500",children:"Stability"}),(0,a.jsxs)("div",{className:"font-medium text-slate-900",children:[null==es.change_48h_pct_calc?"—":"".concat(Number(es.change_48h_pct_calc).toFixed(1),"% 48h"),(0,a.jsx)("span",{className:"ml-1 text-[11px] font-medium text-slate-500",children:eL(es.change_48h_pct_calc)})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-[10px] text-slate-500",children:"Ratio"}),(0,a.jsx)("div",{className:"font-medium text-slate-900",children:null!=es.flow_ratio_calc?"".concat(Number(es.flow_ratio_calc).toFixed(2),"x"):"—"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-[10px] text-slate-500",children:"Hatch likelihood"}),(0,a.jsx)("div",{className:"font-medium text-slate-900",children:ed})]})]}),(0,a.jsxs)("div",{className:"mt-2 text-[11px] text-slate-600",children:["Wind AM ",null!==(y=es.wind_am_mph)&&void 0!==y?y:"—"," • PM ",null!==(x=es.wind_pm_mph)&&void 0!==x?x:"—"]}),(0,a.jsx)("div",{className:"my-3 h-px bg-slate-200/80"}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"text-[11px] font-semibold uppercase tracking-wide text-slate-500",children:["Seasonal Intel (",en.season,")"]}),(0,a.jsxs)("div",{className:"mt-1 text-xs text-slate-700",children:[(0,a.jsx)("span",{className:"font-semibold",children:"Likely bugs:"})," ",en.likelyBugs]}),(0,a.jsxs)("div",{className:"mt-1 text-xs text-slate-700",children:[(0,a.jsx)("span",{className:"font-semibold",children:"Recommended approach:"})," ",en.recommendedApproach]})]}),(0,a.jsx)("button",{className:"mt-3 w-full rounded-lg border border-slate-200/80 bg-white/70 px-2 py-1.5 text-left text-xs font-medium text-slate-700 hover:bg-slate-50",onClick:()=>K(e=>!e),children:"How this score is calculated"}),X&&eo?(0,a.jsxs)("div",{className:"mt-2 rounded-lg bg-slate-50/70 p-2 text-[11px] text-slate-700",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-x-3 gap-y-1",children:[(0,a.jsx)("div",{children:"Flow Score"}),(0,a.jsx)("div",{className:"text-right font-semibold",children:eS(eo.flowScore)}),(0,a.jsx)("div",{children:"Stability Score"}),(0,a.jsx)("div",{className:"text-right font-semibold",children:eS(eo.stabilityScore)}),(0,a.jsx)("div",{children:"Thermal Score"}),(0,a.jsx)("div",{className:"text-right font-semibold",children:eS(eo.thermalScore)}),(0,a.jsx)("div",{children:"Wind Penalty"}),(0,a.jsx)("div",{className:"text-right font-semibold",children:eS(eo.windPenalty)}),(0,a.jsx)("div",{className:"border-t border-slate-200 pt-1 font-semibold",children:"Total Score"}),(0,a.jsx)("div",{className:"border-t border-slate-200 pt-1 text-right font-semibold",children:eS(eo.totalScore)})]}),(0,a.jsxs)("div",{className:"mt-2 border-t border-slate-200 pt-2",children:[(0,a.jsx)("div",{className:"mb-1 text-[10px] font-semibold uppercase tracking-wide text-slate-500",children:"Raw inputs"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-x-3 gap-y-1",children:[(0,a.jsx)("div",{children:"Flow cfs"}),(0,a.jsx)("div",{className:"text-right",children:eS(es.flow_cfs)}),(0,a.jsx)("div",{children:"Median flow"}),(0,a.jsx)("div",{className:"text-right",children:eS(es.median_flow_cfs)}),(0,a.jsx)("div",{children:"Ratio"}),(0,a.jsxs)("div",{className:"text-right",children:[eS(es.flow_ratio_calc,2),"x"]}),(0,a.jsx)("div",{children:"48h change"}),(0,a.jsxs)("div",{className:"text-right",children:[eS(es.change_48h_pct_calc,1),"%"]}),(0,a.jsx)("div",{children:"Temp"}),(0,a.jsxs)("div",{className:"text-right",children:[eS(es.water_temp_f,1),"\xb0F"]}),(0,a.jsx)("div",{children:"Wind AM / PM"}),(0,a.jsxs)("div",{className:"text-right",children:[eS(es.wind_am_mph)," / ",eS(es.wind_pm_mph)]})]}),(0,a.jsx)("div",{className:"mt-2 text-[10px] text-slate-500",children:"Components are estimated from current telemetry values; total score is the live MRI score."})]})]}):null]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"mt-2 text-sm font-semibold text-slate-900",children:"Montana River Intel"}),(0,a.jsx)("div",{className:"text-xs text-slate-600",children:"Tap a river in the list to preview details here."})]})]}):(0,a.jsx)("button",{className:"onx-glass rounded-xl px-3 py-2 text-xs font-medium text-white/90 hover:text-white",onClick:()=>q(!0),children:"Details"})}),(0,a.jsx)("div",{className:"absolute bottom-0 left-0 right-0 z-10",style:{transform:"translateY(".concat(78*A,"%)"),transition:I?"none":"transform 220ms ease-out"},children:(0,a.jsx)("div",{className:"mx-auto max-w-6xl px-3 pb-3 ".concat(Z?"sm:pr-[300px]":""),children:(0,a.jsxs)("div",{className:"onx-glass overflow-hidden rounded-3xl shadow-2xl",children:[(0,a.jsx)("div",{className:"mx-auto mt-2 h-1.5 w-12 flex-shrink-0 cursor-grab rounded-full bg-white/25 active:cursor-grabbing ".concat(I?"select-none":""),onPointerDown:em,onTouchStart:em,title:"Drag to expand/collapse"}),(0,a.jsxs)("div",{className:"flex items-center justify-between px-4 pt-3",children:[(0,a.jsxs)("div",{className:"text-sm font-semibold text-white",children:["Rivers (",ea.length,")"]}),(0,a.jsx)("button",{className:"text-xs text-white/80 hover:text-white",onClick:()=>{let e="collapsed"===E?"mid":"collapsed";T(e),P(M[e])},children:"collapsed"===E?"Expand":"Collapse"})]}),(0,a.jsx)("div",{className:"px-3 pb-3 pt-2",children:(0,a.jsxs)("div",{className:"overflow-auto pr-1 transition-[max-height] duration-200",style:{maxHeight:"expanded"===E?"58vh":"mid"===E?"34vh":"80px"},children:[(0,a.jsx)("div",{className:"grid grid-cols-1 gap-2 sm:grid-cols-2 lg:grid-cols-3",children:ea.map(e=>{var t,r,l;return(0,a.jsx)("button",{onClick:()=>z(e.river_id),className:["rounded-2xl border text-left transition",e.river_id===C?"border-white/45 bg-white/15":"border-white/15 bg-white/5 hover:border-white/25"].join(" "),children:(0,a.jsxs)("div",{className:"p-3",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm font-semibold text-white",children:e.river_name}),(0,a.jsx)("div",{className:"text-xs text-white/70",children:null!==(t=e.gauge_label)&&void 0!==t?t:""})]}),(0,a.jsx)(eN,{tier:"HOT"===e.bite_tier||"GOOD"===e.bite_tier?"Good":"FAIR"===e.bite_tier?"Fair":"TOUGH"===e.bite_tier?"Tough":void 0})]}),(0,a.jsxs)("div",{className:"mt-2 grid grid-cols-3 gap-2 text-xs text-white/85",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-white/60",children:"Score"}),(0,a.jsx)("div",{className:"font-semibold",children:null!==(r=e.fishability_score_calc)&&void 0!==r?r:"—"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-white/60",children:"Flow"}),(0,a.jsxs)("div",{className:"font-semibold",children:[null!==(l=e.flow_cfs)&&void 0!==l?l:"—",(0,a.jsx)("span",{className:"ml-1 text-[11px] font-medium text-white/60",children:eL(e.change_48h_pct_calc)})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-white/60",children:"Temp"}),(0,a.jsx)("div",{className:"font-semibold",children:null!=e.water_temp_f?"".concat(Number(e.water_temp_f).toFixed(1),"\xb0"):"—"})]})]})]})},e.river_id)})}),0===ea.length?(0,a.jsx)("div",{className:"px-2 py-6 text-center text-sm text-white/70",children:"No rivers match your search/filter."}):null]})})]})})})]})}}},function(e){e.O(0,[932,402,93,971,117,744],function(){return e(e.s=2355)}),_N_E=e.O()}]);