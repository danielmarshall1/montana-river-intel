(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{2355:function(e,t,l){Promise.resolve().then(l.bind(l,8144))},8144:function(e,t,l){"use strict";l.d(t,{default:function(){return es}});var r,i,s=l(7437),a=l(2265),n=l(7748),o=l.n(n),c=l(8124),d=l(9397),u=l(1047),m=l(7416),h=l(1349),x=l(7586);l(1322);let v={1:[-111.07,44.66],2:[-110.57,45.6],3:[-112.7,45.53],4:[-114.05,46.83],5:[-115.09,47.3],6:[-114.18,48.36],7:[-111.08,48.31],8:[-111.42,46.15],9:[-111.27,45.5],10:[-111.6,45.9],11:[-110.79,45.11],12:[-113.68,46.72],13:[-114.13,48.5],14:[-115.55,48.4],15:[-115.32,48.4],16:[-107.75,45.46],17:[-113.76,46.9]},p="GPfE5wv1XdVEF8YyaMfc",g=!!p,f=[{id:"dark",label:"Dark",styleUrl:"https://basemaps.cartocdn.com/gl/dark-matter-gl-style/style.json",defaultOn:!0,enabled:!0},{id:"light",label:"Light",styleUrl:"https://basemaps.cartocdn.com/gl/voyager-gl-style/style.json",enabled:!0},{id:"satellite",label:"Satellite",styleUrl:g?"https://api.maptiler.com/maps/satellite/style.json?key=".concat(p):void 0,enabled:g,comingSoon:!g},{id:"hybrid",label:"Hybrid",styleUrl:g?"https://api.maptiler.com/maps/hybrid/style.json?key=".concat(p):void 0,enabled:g,comingSoon:!g}],b=[{id:"public_federal",label:"Federal",group:"Public Lands",defaultOn:!1,source:{id:"public-lands-federal-source",type:"raster",tiles:["https://gis.blm.gov/arcgis/rest/services/lands/BLM_Natl_SMA_Cached_without_PriUnk/MapServer/tile/{z}/{y}/{x}"],tileSize:256,attribution:"BLM Surface Management Agency"},layers:["public-lands-federal-layer"],minZoomNote:"Visible at zoom 7+"},{id:"public_state",label:"State",group:"Public Lands",defaultOn:!1,source:{id:"public-lands-state-source",type:"none"},layers:[],comingSoon:!0},{id:"access_fishing_sites",label:"Fishing Access Sites (MT FWP)",group:"Access",defaultOn:!1,source:{id:"access-fishing-sites-source",type:"geojson",data:"https://fwp-gis.mt.gov/arcgis/rest/services/fwplnd/fwpLands/MapServer/1/query?where=1%3D1&outFields=NAME&returnGeometry=true&f=geojson"},layers:["access-fishing-sites-layer"]},{id:"mri_river_lines",label:"River lines",group:"MRI Overlays",defaultOn:!0,source:{id:"selected-river-source",type:"geojson"},layers:["selected-river-base"]},{id:"mri_selected_highlight",label:"Selected river highlight",group:"MRI Overlays",defaultOn:!0,source:{id:"selected-river-source",type:"geojson"},layers:["selected-river-casing","selected-river-main"]},{id:"mri_river_markers",label:"River markers",group:"MRI Overlays",defaultOn:!1,source:{id:"rivers-source",type:"geojson"},layers:["rivers-unclustered","rivers-selected-halo","rivers-selected-core"]},{id:"mri_score_coloring",label:"Score coloring",group:"MRI Overlays",defaultOn:!1,source:{id:"rivers-source",type:"geojson"},layers:["rivers-unclustered"]},{id:"mri_labels",label:"Labels",group:"MRI Overlays",defaultOn:!1,source:{id:"basemap-style",type:"none"},layers:[]}],y="mri.layers.v2",_=null!==(i=null===(r=f.find(e=>e.defaultOn))||void 0===r?void 0:r.id)&&void 0!==i?i:"dark";function j(){return b.reduce((e,t)=>(e[t.id]=t.defaultOn,e),{})}let w=["Public Lands","Access","MRI Overlays"],N="montana-river-map-labels";function S(){let e=localStorage.getItem(N);return null===e||"true"===e}function L(e){let{map:t}=e,[l,r]=(0,a.useState)(S);return(0,a.useEffect)(()=>{var e;if(!t)return;let r=null===(e=t.getStyle())||void 0===e?void 0:e.layers;if(Array.isArray(r))for(let e of r)e.id.toLowerCase().includes("label")&&t.setLayoutProperty(e.id,"visibility",l?"visible":"none")},[t,l]),(0,s.jsx)("div",{className:"pointer-events-none absolute right-3 bottom-3 z-30 flex flex-col gap-2 rounded-lg p-1.5",children:(0,s.jsxs)("label",{className:"pointer-events-auto flex items-center gap-2 px-2 py-1.5 rounded cursor-pointer hover:bg-white/5 text-sm text-slate-200 bg-slate-900/90 backdrop-blur-sm border border-white/10",children:[(0,s.jsx)("input",{type:"checkbox",checked:l,onChange:()=>{let e=!l;r(e),localStorage.setItem(N,String(e))},className:"rounded border-slate-500 bg-slate-800 text-sky-500"}),"Labels"]})})}let k=[-110.9,46.9],M={HOT:"#dc2626",GOOD:"#16a34a",FAIR:"#ca8a04",TOUGH:"#64748b"},O="rivers-source",F="rivers-unclustered",C="rivers-selected-halo",R="rivers-selected-core",z="selected-river-source",A="selected-river-base",T="selected-river-casing",D="selected-river-main",E="public-lands-federal-source",G="public-lands-federal-layer",P="access-fishing-sites-source",I="access-fishing-sites-layer";function H(e){let t=[];for(let a of e){var l,r,i,s;let e=null!==(l=a.lat)&&void 0!==l?l:a.latitude,n=null!==(r=a.lng)&&void 0!==r?r:a.longitude,o=null!=e&&null!=n?[n,e]:v[a.river_id];o&&t.push({type:"Feature",geometry:{type:"Point",coordinates:o},properties:{river_id:a.river_id,river_name:a.river_name,bite_tier:null!==(i=a.bite_tier)&&void 0!==i?i:null,fishability_score:null!==(s=a.fishability_score_calc)&&void 0!==s?s:null}})}return{type:"FeatureCollection",features:t}}function B(e,t){var l;let r=H(t),i=e.getSource(O);if(!i){e.addSource(O,{type:"geojson",data:r,cluster:!1,generateId:!0});return}null===(l=i.setData)||void 0===l||l.call(i,r)}function U(e){e.getLayer(F)||e.addLayer({id:F,type:"circle",source:O,filter:["==",["geometry-type"],"Point"],paint:{"circle-color":["case",["==",["get","bite_tier"],"HOT"],M.HOT,["==",["get","bite_tier"],"GOOD"],M.GOOD,["==",["get","bite_tier"],"FAIR"],M.FAIR,["==",["get","bite_tier"],"TOUGH"],M.TOUGH,"#94a3b8"],"circle-radius":["case",["boolean",["feature-state","hover"],!1],8,6],"circle-stroke-color":"rgba(255,255,255,0.92)","circle-stroke-width":["case",["boolean",["feature-state","hover"],!1],2.5,2],"circle-opacity":.95}}),e.getLayer(C)||e.addLayer({id:C,type:"circle",source:O,filter:["==",["get","river_id"],"__none__"],paint:{"circle-color":"rgba(56, 189, 248, 0.30)","circle-radius":15}}),e.getLayer(R)||e.addLayer({id:R,type:"circle",source:O,filter:["==",["get","river_id"],"__none__"],paint:{"circle-color":"rgba(255,255,255,0.98)","circle-radius":6,"circle-stroke-color":"rgba(56, 189, 248, 0.98)","circle-stroke-width":2}})}function Z(e,t,l,r){let i=null!=t?t:"__none__",s=l?"visible":"none";for(let t of[F,C,R])e.getLayer(t)&&e.setLayoutProperty(t,"visibility",s);if(e.getLayer(C)&&e.setFilter(C,["==",["get","river_id"],i]),e.getLayer(R)&&e.setFilter(R,["==",["get","river_id"],i]),!e.getLayer(F))return;let a=r?["case",["==",["get","bite_tier"],"HOT"],M.HOT,["==",["get","bite_tier"],"GOOD"],M.GOOD,["==",["get","bite_tier"],"FAIR"],M.FAIR,["==",["get","bite_tier"],"TOUGH"],M.TOUGH,"#94a3b8"]:"#94a3b8";e.setPaintProperty(F,"circle-color",a),e.setPaintProperty(F,"circle-opacity",t?["case",["==",["get","river_id"],t],.95,.38]:.95)}function W(e,t,l,r){var i;if(!t||!l&&!r){e.getLayer(D)&&e.removeLayer(D),e.getLayer(T)&&e.removeLayer(T),e.getLayer(A)&&e.removeLayer(A),e.getSource(z)&&e.removeSource(z);return}let s=t?"FeatureCollection"===t.type||"Feature"===t.type?t:"LineString"===t.type||"MultiLineString"===t.type?{type:"Feature",properties:{},geometry:t}:t:null;if(!s)return;let a=e.getSource(z);a?null===(i=a.setData)||void 0===i||i.call(a,s):e.addSource(z,{type:"geojson",data:s}),l&&!e.getLayer(A)?e.addLayer({id:A,type:"line",source:z,layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#4F6F7A","line-width":["interpolate",["linear"],["zoom"],6,2,10,2.8,12,3.4],"line-opacity":.9}}):!l&&e.getLayer(A)&&e.removeLayer(A),r&&!e.getLayer(T)?e.addLayer({id:T,type:"line",source:z,layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#1E2E33","line-width":["interpolate",["linear"],["zoom"],6,4.4,10,5.8,12,6.6],"line-opacity":.95}}):!r&&e.getLayer(T)&&e.removeLayer(T),r&&!e.getLayer(D)?e.addLayer({id:D,type:"line",source:z,layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#2F5D62","line-width":["interpolate",["linear"],["zoom"],6,3.2,10,4.4,12,5.2],"line-opacity":.98}}):!r&&e.getLayer(D)&&e.removeLayer(D);try{e.getLayer(A)&&e.getLayer(F)&&e.moveLayer(A,F),e.getLayer(T)&&e.getLayer(F)&&e.moveLayer(T,F),e.getLayer(D)&&e.getLayer(F)&&e.moveLayer(D,F)}catch(e){}}function Y(e,t){if(t){e.getSource(E)||e.addSource(E,{type:"raster",tiles:["https://gis.blm.gov/arcgis/rest/services/lands/BLM_Natl_SMA_Cached_without_PriUnk/MapServer/tile/{z}/{y}/{x}"],tileSize:256,attribution:"BLM Surface Management Agency"}),e.getLayer(G)||e.addLayer({id:G,type:"raster",source:E,minzoom:7,paint:{"raster-opacity":.24,"raster-saturation":-.55,"raster-contrast":-.2,"raster-brightness-min":.15,"raster-brightness-max":.82}});return}e.getLayer(G)&&e.removeLayer(G)}function q(e,t){if(t){e.getSource(P)||e.addSource(P,{type:"geojson",data:"https://fwp-gis.mt.gov/arcgis/rest/services/fwplnd/fwpLands/MapServer/1/query?where=1%3D1&outFields=NAME&returnGeometry=true&f=geojson"}),e.getLayer(I)||e.addLayer({id:I,type:"circle",source:P,paint:{"circle-color":"#38bdf8","circle-radius":4,"circle-stroke-color":"#e2e8f0","circle-stroke-width":1.25,"circle-opacity":.95}});return}e.getLayer(I)&&e.removeLayer(I)}function J(e,t){var l;let r=e.getStyle(),i=t?"visible":"none";for(let t of null!==(l=r.layers)&&void 0!==l?l:[]){if(!t.id)continue;let l=t.id.toLowerCase();if(l.includes("label")||l.includes("place")||l.includes("poi"))try{e.setLayoutProperty(t.id,"visibility",i)}catch(e){}}}function V(e){let{rivers:t,selectedRiver:l,selectedRiverId:r,selectedRiverGeojson:i,layerState:n,onSelectRiver:c,className:d,initialStyleUrl:u,onMapReady:m}=e,h=null!=n?n:j(),x=(0,a.useRef)(null),p=(0,a.useRef)(null),g=(0,a.useRef)(t),f=(0,a.useRef)(c),b=(0,a.useRef)(r),y=(0,a.useRef)(i),_=(0,a.useRef)(h),w=(0,a.useRef)(null),N=(0,a.useRef)(null),[S,M]=(0,a.useState)(!1);g.current=t,f.current=c,b.current=r,y.current=i,_.current=h;let C=(0,a.useCallback)(e=>{B(e,g.current),U(e),Z(e,b.current,_.current.mri_river_markers,_.current.mri_score_coloring),W(e,y.current,_.current.mri_river_lines,_.current.mri_selected_highlight),Y(e,_.current.public_federal),q(e,_.current.access_fishing_sites),J(e,_.current.mri_labels)},[]),R=(0,a.useCallback)(()=>{if(!x.current)return;let e=new(o()).Map({container:x.current,style:null!=u?u:"https://basemaps.cartocdn.com/gl/dark-matter-gl-style/style.json",center:k,zoom:5.2,pitch:22,bearing:-5});e.addControl(new(o()).NavigationControl,"top-right"),p.current=e,e.on("load",()=>{M(!0),null==m||m(e),C(e),e.resize()}),e.__mriHandlers||(e.__mriHandlers=!0,e.on("click",F,e=>{var t,l;let r=null===(t=e.features)||void 0===t?void 0:t[0],i=null==r?void 0:null===(l=r.properties)||void 0===l?void 0:l.river_id;if(!i)return;let s=g.current.find(e=>e.river_id===i);s&&f.current(s)}),e.on("mousemove",F,t=>{var l;e.getCanvas().style.cursor="pointer";let r=null===(l=t.features)||void 0===l?void 0:l[0],i=null==r?void 0:r.id;if(null!=i){if(null!=w.current&&w.current!==i)try{e.setFeatureState({source:O,id:w.current},{hover:!1})}catch(e){}w.current=i;try{e.setFeatureState({source:O,id:i},{hover:!0})}catch(e){}}}),e.on("mouseleave",F,()=>{if(e.getCanvas().style.cursor="",null!=w.current)try{e.setFeatureState({source:O,id:w.current},{hover:!1})}catch(e){}w.current=null}))},[u,m,C]);(0,a.useEffect)(()=>(R(),()=>{var e;null===(e=p.current)||void 0===e||e.remove(),p.current=null,N.current=null}),[R]),(0,a.useEffect)(()=>{let e=p.current;if(!e||!x.current)return;let t=()=>e.resize();window.addEventListener("resize",t);let l=new ResizeObserver(()=>e.resize());return l.observe(x.current),()=>{window.removeEventListener("resize",t),l.disconnect()}},[S]);let z=t.map(e=>e.river_id).join(",");return(0,a.useEffect)(()=>{let e=p.current;if(e&&S&&("function"!=typeof e.isStyleLoaded||e.isStyleLoaded())&&(B(e,t),U(e),Z(e,r,h.mri_river_markers,h.mri_score_coloring),!r)){let l=H(t);if(l.features.length){let t=new(o()).LngLatBounds(l.features[0].geometry.coordinates,l.features[0].geometry.coordinates);for(let e of l.features)t.extend(e.geometry.coordinates);e.fitBounds(t,{padding:60,duration:450})}}},[z,S,t,r,h.mri_river_markers,h.mri_score_coloring]),(0,a.useEffect)(()=>{let e=p.current;if(!e||!S||"function"==typeof e.isStyleLoaded&&!e.isStyleLoaded())return;if(Z(e,r,h.mri_river_markers,h.mri_score_coloring),W(e,i,h.mri_river_lines,h.mri_selected_highlight),!r){N.current=null;return}if(N.current===r)return;N.current=r;let t=(null==l?void 0:l.lat)!=null&&(null==l?void 0:l.lng)!=null?[l.lng,l.lat]:v[r];if(i){let t=function(e){let t=[],l=e=>{if("Point"===e.type)t.push(e.coordinates);else if("LineString"===e.type)for(let l of e.coordinates)t.push(l);else if("MultiLineString"===e.type)for(let l of e.coordinates)for(let e of l)t.push(e);else if("Polygon"===e.type)for(let l of e.coordinates)for(let e of l)t.push(e);else if("MultiPoint"===e.type)for(let l of e.coordinates)t.push(l)};if("geometry"in e&&e.geometry)l(e.geometry);else if("coordinates"in e)l(e);else if("features"in e)for(let t of e.features)t.geometry&&l(t.geometry);if(!t.length)return null;let r=t.map(e=>e[0]),i=t.map(e=>e[1]);return[Math.min(...r),Math.min(...i),Math.max(...r),Math.max(...i)]}(i);if(t&&e.fitBounds){e.fitBounds([[t[0],t[1]],[t[2],t[3]]],{padding:60,duration:700,essential:!0});return}}t&&e.flyTo({center:t,zoom:9.5,duration:667,curve:1.5,essential:!0})},[r,i,l,h.mri_river_lines,h.mri_selected_highlight,h.mri_river_markers,h.mri_score_coloring,S]),(0,a.useEffect)(()=>{let e=p.current;e&&S&&("function"!=typeof e.isStyleLoaded||e.isStyleLoaded())&&(Y(e,h.public_federal),q(e,h.access_fishing_sites),J(e,h.mri_labels))},[S,h.public_federal,h.access_fishing_sites,h.mri_labels]),(0,a.useEffect)(()=>{let e=p.current;if(!e||!S)return;let t=()=>{C(e)};return e.on("load",t),()=>{e.off("load",t)}},[S,C]),(0,s.jsx)("div",{id:"map",ref:x,className:"absolute inset-0 h-full w-full min-h-0 [&_.maplibregl-marker]:cursor-pointer ".concat(null!=d?d:"").trim(),"aria-label":"Montana river map",children:S&&p.current&&(0,s.jsx)(L,{map:p.current})})}var X=l(3053);let K="https://relkyvqwmfbmzzlqypmu.supabase.co",Q="sb_publishable_PxejFrRRvhrHai_FtjAGoA_rlM9S9_e",$=K&&Q?(0,X.eI)(K,Q):null;async function ee(e){var t;if(!$)return null;let{data:l,error:r}=await $.from("river_geoms").select("geom").eq("river_id",e).single();return r||!l?null:null!==(t=l.geom)&&void 0!==t?t:null}async function et(e){if(!e||!$)return null;let{data:t,error:l}=await $.rpc("get_river_geojson_by_slug",{p_slug:e});return l?(console.error("[fetchRiverGeojsonBrowser] rpc error:",l),null):null!=t?t:null}function el(e,t,l){return Math.max(t,Math.min(l,e))}function er(e){let{tier:t}=e,l="Good"===t||"HOT"===t||"GOOD"===t?"bg-green-500":"Fair"===t||"FAIR"===t?"bg-yellow-500":"bg-slate-400";return(0,s.jsxs)("span",{className:"inline-flex items-center gap-2 text-xs font-semibold text-white/90",children:[(0,s.jsx)("span",{className:"h-2.5 w-2.5 rounded-full ".concat(l)}),"HOT"===t||"GOOD"===t?"Good":"FAIR"===t?"Fair":"TOUGH"===t?"Tough":null!=t?t:"—"]})}function ei(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return null==e||Number.isNaN(e)?"—":Number(e).toFixed(t)}function es(e){var t,l,r,i,n,p,g;let{rivers:N,dateLabel:S=new Date().toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric",year:"numeric"})}=e,[L,k]=(0,a.useState)(""),[M,O]=(0,a.useState)("All"),[F,C]=(0,a.useState)(null),[R,z]=(0,a.useState)(!0),[A,T]=(0,a.useState)(0),[D,E]=(0,a.useState)(!1),G=(0,a.useRef)(null),[P,I]=(0,a.useState)(null),H=(0,a.useRef)(null),[B,U]=(0,a.useState)(!1),[Z,W]=(0,a.useState)(!1),[Y,q]=(0,a.useState)(!1),[J,X]=(0,a.useState)(!1),[K,Q]=(0,a.useState)(_),[$,es]=(0,a.useState)(j()),ea=(0,a.useMemo)(()=>Object.fromEntries(f.map(e=>[e.id,e])),[]),en=(0,a.useMemo)(()=>{let e=L.trim().toLowerCase();return(null!=N?N:[]).filter(t=>{var l,r;let i=!e||(null!==(l=t.river_name)&&void 0!==l?l:"").toLowerCase().includes(e)||(null!==(r=t.gauge_label)&&void 0!==r?r:"").toLowerCase().includes(e),s="HOT"===t.bite_tier||"GOOD"===t.bite_tier?"Good":"FAIR"===t.bite_tier?"Fair":"TOUGH"===t.bite_tier?"Tough":"";return i&&("All"===M||s===M)}).sort((e,t)=>{var l,r;return(null!==(l=t.fishability_score_calc)&&void 0!==l?l:-999)-(null!==(r=e.fishability_score_calc)&&void 0!==r?r:-999)})},[N,L,M]),eo=(0,a.useMemo)(()=>{var e,t;return F&&null!==(t=null!==(e=en.find(e=>e.river_id===F))&&void 0!==e?e:N.find(e=>e.river_id===F))&&void 0!==t?t:null},[en,N,F]),ec=(0,a.useMemo)(()=>(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Date,t=e.getMonth();return 11===t||t<=1?{season:"Winter",likelyBugs:"Midges, Blue-Winged Olives (low activity windows)",recommendedApproach:"Fish slow seams and tailouts with small nymphs or midge dries during warmest hours."}:t>=2&&t<=4?{season:"Spring",likelyBugs:"Skwala, Baetis, early caddis",recommendedApproach:"Target afternoon windows; mix dry-dropper with short nymph rigs as flows stabilize."}:t>=5&&t<=7?{season:"Summer",likelyBugs:"PMD, caddis, stoneflies, terrestrials",recommendedApproach:"Cover pocket water and banks with attractor dries, then switch to nymphs when surface slows."}:{season:"Fall",likelyBugs:"Baetis, mahogany duns, midges",recommendedApproach:"Fish midday hatches and focus on softer edges with emergers, small dries, and light nymph rigs."}})(),[]),ed=(0,a.useMemo)(()=>eo?function(e){var t,l,r;let i=e.flow_ratio_calc,s=e.change_48h_pct_calc,a=e.water_temp_f,n=null!=e.wind_am_mph&&null!=e.wind_pm_mph?(e.wind_am_mph+e.wind_pm_mph)/2:null!==(l=null!==(t=e.wind_am_mph)&&void 0!==t?t:e.wind_pm_mph)&&void 0!==l?l:null,o=null==i||i<=0?null:Math.round(el(30-14*Math.abs(Math.log2(i)),0,30));return{flowScore:o,stabilityScore:null==s?null:Math.round(el(25-.8*Math.abs(s),0,25)),thermalScore:null==a?null:Math.round(el(25-1.2*Math.abs(a-56),0,25)),windPenalty:null==n?null:Math.round(el(1.2*n,0,20)),totalScore:null!==(r=e.fishability_score_calc)&&void 0!==r?r:null}}(eo):null,[eo]),eu=(0,a.useMemo)(()=>"Summer"===ec.season?"High":"Spring"===ec.season||"Fall"===ec.season?"Moderate":"Low",[ec.season]);(0,a.useEffect)(()=>{let e=!1;return(async function(){var t,l,r;if(!F){I(null);return}let i=null!==(t=en.find(e=>e.river_id===F))&&void 0!==t?t:N.find(e=>e.river_id===F),s=null!==(r=null!==(l=null==i?void 0:i.slug)&&void 0!==l?l:null==i?void 0:i.river_id)&&void 0!==r?r:F,a=await et(s);if(e)return;if(a){I(a);return}let n=await ee(F);e||I(n?{type:"Feature",geometry:n,properties:{river_id:F}}:null)})().catch(()=>{e||I(null)}),()=>{e=!0}},[F,en,N]),(0,a.useEffect)(()=>{if(eo){U(!0);return}U(!1),q(!1)},[eo]),(0,a.useEffect)(()=>{try{let e=localStorage.getItem(y);if(!e)return;let t=JSON.parse(e);if(t.basemap&&ea[t.basemap]&&Q(t.basemap),t.layerState){let e={...j()};for(let l of b)"boolean"==typeof t.layerState[l.id]&&(e[l.id]=t.layerState[l.id]);es(e)}}catch(e){}},[ea]),(0,a.useEffect)(()=>{try{localStorage.setItem(y,JSON.stringify({basemap:K,layerState:$}))}catch(e){}},[K,$]);let em=null!==(l=null===(t=ea[K])||void 0===t?void 0:t.styleUrl)&&void 0!==l?l:ea[_].styleUrl;function eh(e){var t;let l="touches"in e?null===(t=e.touches[0])||void 0===t?void 0:t.clientY:e.clientY;if(null==l)return;G.current={startY:l,startSheetY:A},E(!0);let r=e=>{var t;let l="touches"in e?null===(t=e.touches[0])||void 0===t?void 0:t.clientY:e.clientY;if(null==l||!G.current)return;let r=l-G.current.startY;T(Math.max(0,Math.min(1,G.current.startSheetY+r/320)))},i=()=>{G.current&&(G.current=null,E(!1),T(e=>{let t=e>.45?1:0;return z(0===t),t}),document.removeEventListener("pointermove",r),document.removeEventListener("pointerup",i),document.removeEventListener("touchmove",r),document.removeEventListener("touchend",i))};document.addEventListener("pointermove",r),document.addEventListener("pointerup",i),document.addEventListener("touchmove",r,{passive:!0}),document.addEventListener("touchend",i)}function ex(e,t){es(l=>({...l,[e]:t}))}let ev=(0,a.useMemo)(()=>w.map(e=>({group:e,layers:b.filter(t=>t.group===e)})),[]);return(0,s.jsxs)("div",{className:"relative h-[100dvh] w-full overflow-hidden bg-black",children:[(0,s.jsx)("div",{className:"absolute inset-0",children:(0,s.jsx)(V,{rivers:en,selectedRiver:eo,selectedRiverId:F,selectedRiverGeojson:P,layerState:$,onSelectRiver:e=>C(e.river_id),className:"absolute inset-0",initialStyleUrl:em,onMapReady:e=>{H.current=e}})}),(0,s.jsx)("div",{className:"absolute left-3 top-3 z-30 hidden sm:block",children:(0,s.jsxs)("div",{className:"onx-glass w-[84px] overflow-hidden rounded-2xl",children:[(0,s.jsxs)("div",{className:"border-b border-white/10 px-3 py-3",children:[(0,s.jsx)("div",{className:"text-sm font-semibold leading-tight text-white",children:"MRI"}),(0,s.jsx)("div",{className:"text-[10px] leading-tight text-white/70",children:"Montana"})]}),(0,s.jsxs)("div",{className:"flex flex-col gap-2 p-2",children:[(0,s.jsx)("button",{className:"onx-iconbtn",title:"Map",children:"\uD83D\uDDFA️"}),(0,s.jsx)("button",{className:"onx-iconbtn",title:"Rivers",children:"\uD83C\uDFA3"}),(0,s.jsx)("button",{className:"onx-iconbtn",title:"Reports",children:"\uD83D\uDCC4"}),(0,s.jsx)("button",{className:"onx-iconbtn ".concat(Z?"ring-2 ring-cyan-300/60":""),title:"Layers",onClick:()=>W(e=>!e),children:(0,s.jsx)(c.Z,{size:18,strokeWidth:2.5})})]})]})}),(0,s.jsx)("button",{className:"onx-iconbtn absolute bottom-24 right-3 z-30 sm:hidden",title:"Layers",onClick:()=>W(e=>!e),children:(0,s.jsx)(c.Z,{size:18,strokeWidth:2.5})}),(0,s.jsxs)("div",{className:"absolute left-3 right-3 top-3 z-30 sm:left-[108px] sm:right-[240px]",children:[(0,s.jsxs)("div",{className:"onx-glass flex items-center gap-2 rounded-2xl px-3 py-2",children:[(0,s.jsxs)("div",{className:"hidden text-xs font-semibold text-white/80 sm:block",children:[S," • ",en.length," rivers"]}),(0,s.jsx)("div",{className:"flex-1",children:(0,s.jsx)("input",{value:L,onChange:e=>k(e.target.value),placeholder:"Search rivers...",className:"w-full bg-transparent text-sm text-white placeholder:text-white/60 outline-none"})}),(0,s.jsx)("button",{className:"rounded-lg px-2 py-1 text-xs text-white/80 hover:text-white",onClick:()=>{k(""),O("All"),C(null)},children:"Reset"})]}),(0,s.jsx)("div",{className:"mt-2 flex flex-wrap gap-2",children:["All","Good","Fair","Tough"].map(e=>(0,s.jsx)("button",{onClick:()=>O(e),className:["h-9 rounded-full border px-3 text-sm font-medium backdrop-blur",M===e?"border-slate-200 bg-white/90 text-slate-900":"border-white/20 bg-slate-900/50 text-white hover:bg-slate-900/60"].join(" "),children:e},e))})]}),(0,s.jsxs)("div",{className:"absolute right-3 top-3 z-30 hidden flex-col gap-2 sm:flex",children:[(0,s.jsx)("button",{className:"onx-iconbtn",title:"Zoom in",onClick:function(){var e,t;null===(t=H.current)||void 0===t||null===(e=t.zoomIn)||void 0===e||e.call(t,{duration:180})},children:(0,s.jsx)(d.Z,{size:18,strokeWidth:2.5})}),(0,s.jsx)("button",{className:"onx-iconbtn",title:"Zoom out",onClick:function(){var e,t;null===(t=H.current)||void 0===t||null===(e=t.zoomOut)||void 0===e||e.call(t,{duration:180})},children:(0,s.jsx)(u.Z,{size:18,strokeWidth:2.5})}),(0,s.jsx)("button",{className:"onx-iconbtn",title:"Fit to rivers",onClick:function(){let e=H.current;if(!e||!en.length)return;let t=new(o()).LngLatBounds,l=!1;for(let e of en){var r,i;let s=null!==(r=e.lat)&&void 0!==r?r:e.latitude,a=null!==(i=e.lng)&&void 0!==i?i:e.longitude,n=null!=s&&null!=a?[a,s]:v[e.river_id];n&&(t.extend(n),l=!0)}l&&!t.isEmpty()&&e.fitBounds(t,{padding:60,duration:450,essential:!0})},children:(0,s.jsx)(m.Z,{size:18,strokeWidth:2.5})}),(0,s.jsx)("button",{className:"onx-iconbtn",title:"Recenter Montana",onClick:function(){var e,t;null===(t=H.current)||void 0===t||null===(e=t.flyTo)||void 0===e||e.call(t,{center:[-110.9,46.9],zoom:5.2,duration:450,essential:!0})},children:(0,s.jsx)(h.Z,{size:18,strokeWidth:2.5})}),(0,s.jsx)("button",{className:"onx-iconbtn",title:"Toggle river list",onClick:()=>{let e=!R;z(e),T(e?0:1)},children:(0,s.jsx)(x.Z,{size:18,strokeWidth:2.5})})]}),(0,s.jsx)("div",{className:["absolute left-3 top-16 z-40 w-[calc(100%-1rem)] sm:left-[108px] sm:top-[96px] sm:w-[360px]","transition-all duration-200",Z?"translate-y-0 opacity-100":"pointer-events-none -translate-y-1 opacity-0"].join(" "),children:(0,s.jsxs)("div",{className:"onx-card rounded-2xl border border-slate-200/70 p-4 shadow-xl",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-sm font-semibold text-slate-900",children:"Layers"}),(0,s.jsx)("div",{className:"text-[11px] text-slate-500",children:"Map display controls"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("button",{className:"text-[11px] font-medium text-slate-500 hover:text-slate-700",onClick:function(){es(j()),Q(_)},children:"Reset layers"}),(0,s.jsx)("button",{className:"text-[11px] font-medium text-slate-500 hover:text-slate-700",onClick:()=>W(!1),children:"Close"})]})]}),(0,s.jsx)("div",{className:"mt-4 text-[11px] font-semibold uppercase tracking-wide text-slate-500",children:"Basemap"}),(0,s.jsx)("div",{className:"mt-2 grid grid-cols-2 gap-2",children:f.map(e=>{let t=K===e.id;return(0,s.jsxs)("button",{disabled:!e.enabled,className:["rounded-lg border px-2 py-1.5 text-xs font-medium",t?"border-slate-900 bg-slate-900 text-white":"border-slate-300 bg-white text-slate-700",e.enabled?"hover:bg-slate-50":"cursor-not-allowed opacity-55"].join(" "),onClick:()=>(function(e){var t,l,r,i;let s=ea[e];if(!(null==s?void 0:s.enabled)||!s.styleUrl)return;Q(e);let a=H.current;if(!a)return;let n=null===(t=a.getCenter)||void 0===t?void 0:t.call(a),o=null===(l=a.getZoom)||void 0===l?void 0:l.call(a),c=null===(r=a.getBearing)||void 0===r?void 0:r.call(a),d=null===(i=a.getPitch)||void 0===i?void 0:i.call(a);a.setStyle(s.styleUrl),a.once("load",()=>{var e;try{n&&a.setCenter(n),null!=o&&a.setZoom(o),null!=c&&a.setBearing(c),null!=d&&a.setPitch(d)}catch(e){}null===(e=a.resize)||void 0===e||e.call(a)})})(e.id),children:[(0,s.jsx)("div",{children:e.label}),!e.enabled&&e.comingSoon?(0,s.jsx)("div",{className:"text-[10px] text-slate-500",children:"Coming soon"}):null]},e.id)})}),(0,s.jsxs)("div",{className:"mt-4",children:[(0,s.jsx)("div",{className:"text-[11px] font-semibold uppercase tracking-wide text-slate-500",children:"Core Layers"}),(0,s.jsx)("div",{className:"mt-2 space-y-2 rounded-xl border border-slate-200 bg-slate-50/80 p-2.5 text-xs text-slate-700",children:ev.flatMap(e=>e.layers).filter(e=>"mri_river_lines"===e.id||"mri_selected_highlight"===e.id).map(e=>(0,s.jsxs)("label",{className:"flex items-start justify-between gap-3",children:[(0,s.jsx)("span",{className:"leading-tight",children:(0,s.jsx)("span",{className:"block",children:e.label})}),(0,s.jsx)("input",{type:"checkbox",checked:$[e.id],onChange:t=>ex(e.id,t.target.checked)})]},e.id))})]}),(0,s.jsx)("div",{className:"mt-4",children:(0,s.jsx)("button",{className:"w-full rounded-lg border border-slate-200 bg-white px-2.5 py-2 text-left text-xs font-medium text-slate-700 hover:bg-slate-50",onClick:()=>X(e=>!e),children:J?"Hide Advanced Layers":"Advanced Layers"})}),J?ev.map(e=>{let{group:t,layers:l}=e;return(0,s.jsxs)("div",{className:"mt-4",children:[(0,s.jsx)("div",{className:"text-[11px] font-semibold uppercase tracking-wide text-slate-500",children:t}),(0,s.jsx)("div",{className:"mt-2 space-y-2 rounded-xl border border-slate-200 bg-slate-50/80 p-2.5 text-xs text-slate-700",children:l.filter(e=>"mri_river_lines"!==e.id&&"mri_selected_highlight"!==e.id).map(e=>{let t=$[e.id],l=!!e.comingSoon;return(0,s.jsxs)("label",{className:"flex items-start justify-between gap-3",children:[(0,s.jsxs)("span",{className:"leading-tight",children:[(0,s.jsx)("span",{className:"block",children:e.label}),e.minZoomNote?(0,s.jsx)("span",{className:"text-[10px] text-slate-500",children:e.minZoomNote}):null,e.comingSoon?(0,s.jsx)("span",{className:"text-[10px] text-slate-500",children:"Coming soon"}):null]}),(0,s.jsx)("input",{type:"checkbox",checked:t,disabled:l,onChange:t=>ex(e.id,t.target.checked)})]},e.id)})})]},t)}):null]})}),(0,s.jsx)("div",{className:"absolute right-3 top-[120px] z-30 hidden w-[280px] sm:block",children:B?(0,s.jsxs)("div",{className:"onx-card rounded-2xl p-4 shadow-xl",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("div",{className:"text-[11px] font-semibold uppercase tracking-wide text-slate-500",children:"River Detail"}),(0,s.jsx)("button",{className:"text-[11px] text-slate-500 hover:text-slate-700",onClick:()=>U(!1),children:"Collapse"})]}),eo?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"mt-2 text-[15px] font-semibold text-slate-900",children:eo.river_name}),(0,s.jsx)("div",{className:"text-xs text-slate-600",children:null!==(r=eo.gauge_label)&&void 0!==r?r:""}),(0,s.jsx)("div",{className:"mt-2",children:(0,s.jsx)(er,{tier:"HOT"===eo.bite_tier||"GOOD"===eo.bite_tier?"Good":"FAIR"===eo.bite_tier?"Fair":"TOUGH"===eo.bite_tier?"Tough":void 0})}),(0,s.jsxs)("div",{className:"mt-3 grid grid-cols-2 gap-x-4 gap-y-2 text-xs",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-slate-500",children:"Score"}),(0,s.jsx)("div",{className:"font-semibold text-slate-900",children:null!==(i=eo.fishability_score_calc)&&void 0!==i?i:"—"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-slate-500",children:"Flow"}),(0,s.jsx)("div",{className:"font-semibold text-slate-900",children:null!==(n=eo.flow_cfs)&&void 0!==n?n:"—"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-slate-500",children:"Temp"}),(0,s.jsx)("div",{className:"font-semibold text-slate-900",children:null!=eo.water_temp_f?"".concat(Number(eo.water_temp_f).toFixed(1),"\xb0F"):"—"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-slate-500",children:"Stability"}),(0,s.jsx)("div",{className:"font-semibold text-slate-900",children:null==eo.change_48h_pct_calc?"—":"".concat(Number(eo.change_48h_pct_calc).toFixed(1),"% 48h")})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-slate-500",children:"Ratio"}),(0,s.jsx)("div",{className:"font-semibold text-slate-900",children:null!=eo.flow_ratio_calc?"".concat(Number(eo.flow_ratio_calc).toFixed(2),"x"):"—"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-slate-500",children:"Hatch likelihood"}),(0,s.jsx)("div",{className:"font-semibold text-slate-900",children:eu})]})]}),(0,s.jsxs)("div",{className:"mt-2 text-[11px] text-slate-600",children:["Wind AM ",null!==(p=eo.wind_am_mph)&&void 0!==p?p:"—"," • PM ",null!==(g=eo.wind_pm_mph)&&void 0!==g?g:"—"]}),(0,s.jsx)("div",{className:"my-3 h-px bg-slate-200/80"}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"text-[11px] font-semibold uppercase tracking-wide text-slate-500",children:["Seasonal Intel (",ec.season,")"]}),(0,s.jsxs)("div",{className:"mt-1 text-xs text-slate-700",children:[(0,s.jsx)("span",{className:"font-semibold",children:"Likely bugs:"})," ",ec.likelyBugs]}),(0,s.jsxs)("div",{className:"mt-1 text-xs text-slate-700",children:[(0,s.jsx)("span",{className:"font-semibold",children:"Recommended approach:"})," ",ec.recommendedApproach]})]}),(0,s.jsx)("button",{className:"mt-3 w-full rounded-lg border border-slate-200/80 bg-white/70 px-2 py-1.5 text-left text-xs font-medium text-slate-700 hover:bg-slate-50",onClick:()=>q(e=>!e),children:"How this score is calculated"}),Y&&ed?(0,s.jsxs)("div",{className:"mt-2 rounded-lg bg-slate-50/70 p-2 text-[11px] text-slate-700",children:[(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-x-3 gap-y-1",children:[(0,s.jsx)("div",{children:"Flow Score"}),(0,s.jsx)("div",{className:"text-right font-semibold",children:ei(ed.flowScore)}),(0,s.jsx)("div",{children:"Stability Score"}),(0,s.jsx)("div",{className:"text-right font-semibold",children:ei(ed.stabilityScore)}),(0,s.jsx)("div",{children:"Thermal Score"}),(0,s.jsx)("div",{className:"text-right font-semibold",children:ei(ed.thermalScore)}),(0,s.jsx)("div",{children:"Wind Penalty"}),(0,s.jsx)("div",{className:"text-right font-semibold",children:ei(ed.windPenalty)}),(0,s.jsx)("div",{className:"border-t border-slate-200 pt-1 font-semibold",children:"Total Score"}),(0,s.jsx)("div",{className:"border-t border-slate-200 pt-1 text-right font-semibold",children:ei(ed.totalScore)})]}),(0,s.jsxs)("div",{className:"mt-2 border-t border-slate-200 pt-2",children:[(0,s.jsx)("div",{className:"mb-1 text-[10px] font-semibold uppercase tracking-wide text-slate-500",children:"Raw inputs"}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-x-3 gap-y-1",children:[(0,s.jsx)("div",{children:"Flow cfs"}),(0,s.jsx)("div",{className:"text-right",children:ei(eo.flow_cfs)}),(0,s.jsx)("div",{children:"Median flow"}),(0,s.jsx)("div",{className:"text-right",children:ei(eo.median_flow_cfs)}),(0,s.jsx)("div",{children:"Ratio"}),(0,s.jsxs)("div",{className:"text-right",children:[ei(eo.flow_ratio_calc,2),"x"]}),(0,s.jsx)("div",{children:"48h change"}),(0,s.jsxs)("div",{className:"text-right",children:[ei(eo.change_48h_pct_calc,1),"%"]}),(0,s.jsx)("div",{children:"Temp"}),(0,s.jsxs)("div",{className:"text-right",children:[ei(eo.water_temp_f,1),"\xb0F"]}),(0,s.jsx)("div",{children:"Wind AM / PM"}),(0,s.jsxs)("div",{className:"text-right",children:[ei(eo.wind_am_mph)," / ",ei(eo.wind_pm_mph)]})]}),(0,s.jsx)("div",{className:"mt-2 text-[10px] text-slate-500",children:"Components are estimated from current telemetry values; total score is the live MRI score."})]})]}):null]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"mt-2 text-sm font-semibold text-slate-900",children:"Montana River Intel"}),(0,s.jsx)("div",{className:"text-xs text-slate-600",children:"Tap a river in the list to preview details here."})]})]}):(0,s.jsx)("button",{className:"onx-glass rounded-xl px-3 py-2 text-xs font-medium text-white/90 hover:text-white",onClick:()=>U(!0),children:"Details"})}),(0,s.jsx)("div",{className:"absolute bottom-0 left-0 right-0 z-30",style:{transform:"translateY(".concat((R?A:Math.max(A,.75))*78,"%)"),transition:D?"none":"transform 180ms ease-out"},children:(0,s.jsx)("div",{className:"mx-auto max-w-6xl px-3 pb-3",children:(0,s.jsxs)("div",{className:"onx-glass overflow-hidden rounded-3xl shadow-2xl",children:[(0,s.jsx)("div",{className:"mx-auto mt-2 h-1.5 w-12 flex-shrink-0 cursor-grab rounded-full bg-white/25 active:cursor-grabbing",onPointerDown:eh,onTouchStart:eh,title:"Drag to expand/collapse"}),(0,s.jsxs)("div",{className:"flex items-center justify-between px-4 pt-3",children:[(0,s.jsxs)("div",{className:"text-sm font-semibold text-white",children:["Rivers (",en.length,")"]}),(0,s.jsx)("button",{className:"text-xs text-white/80 hover:text-white",onClick:()=>{let e=!R;z(e),T(e?0:1)},children:R?"Collapse":"Expand"})]}),(0,s.jsx)("div",{className:"px-3 pb-3 pt-2",children:(0,s.jsxs)("div",{className:"max-h-[34vh] overflow-auto pr-1",children:[(0,s.jsx)("div",{className:"grid grid-cols-1 gap-2 sm:grid-cols-2 lg:grid-cols-3",children:en.map(e=>{var t,l,r;return(0,s.jsx)("button",{onClick:()=>C(e.river_id),className:["rounded-2xl border text-left transition",e.river_id===F?"border-white/45 bg-white/15":"border-white/15 bg-white/5 hover:border-white/25"].join(" "),children:(0,s.jsxs)("div",{className:"p-3",children:[(0,s.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-sm font-semibold text-white",children:e.river_name}),(0,s.jsx)("div",{className:"text-xs text-white/70",children:null!==(t=e.gauge_label)&&void 0!==t?t:""})]}),(0,s.jsx)(er,{tier:"HOT"===e.bite_tier||"GOOD"===e.bite_tier?"Good":"FAIR"===e.bite_tier?"Fair":"TOUGH"===e.bite_tier?"Tough":void 0})]}),(0,s.jsxs)("div",{className:"mt-2 grid grid-cols-3 gap-2 text-xs text-white/85",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-white/60",children:"Score"}),(0,s.jsx)("div",{className:"font-semibold",children:null!==(l=e.fishability_score_calc)&&void 0!==l?l:"—"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-white/60",children:"Flow"}),(0,s.jsx)("div",{className:"font-semibold",children:null!==(r=e.flow_cfs)&&void 0!==r?r:"—"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-white/60",children:"Temp"}),(0,s.jsx)("div",{className:"font-semibold",children:null!=e.water_temp_f?"".concat(Number(e.water_temp_f).toFixed(1),"\xb0"):"—"})]})]})]})},e.river_id)})}),0===en.length?(0,s.jsx)("div",{className:"px-2 py-6 text-center text-sm text-white/70",children:"No rivers match your search/filter."}):null]})})]})})})]})}}},function(e){e.O(0,[932,402,93,971,117,744],function(){return e(e.s=2355)}),_N_E=e.O()}]);