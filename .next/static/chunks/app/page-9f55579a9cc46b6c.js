(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{2355:function(e,t,r){Promise.resolve().then(r.bind(r,8144))},8144:function(e,t,r){"use strict";r.d(t,{default:function(){return ex}});var l,i,s=r(7437),a=r(2265),n=r(7748),o=r.n(n),c=r(8124),d=r(9397),u=r(1047),m=r(7416),h=r(1349),v=r(7586);r(1322);let p={1:[-111.07,44.66],2:[-110.57,45.6],3:[-112.7,45.53],4:[-114.05,46.83],5:[-115.09,47.3],6:[-114.18,48.36],7:[-111.08,48.31],8:[-111.42,46.15],9:[-111.27,45.5],10:[-111.6,45.9],11:[-110.79,45.11],12:[-113.68,46.72],13:[-114.13,48.5],14:[-115.55,48.4],15:[-115.32,48.4],16:[-107.75,45.46],17:[-113.76,46.9]},g="GPfE5wv1XdVEF8YyaMfc",y=!!g;function x(e){let t={id:"esri_satellite",type:"raster",tiles:["https://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}"],tileSize:256,attribution:"Esri, Maxar, Earthstar Geographics"};return JSON.stringify({version:8,sources:e?{esri_satellite:t,esri_labels:{id:"esri_labels",type:"raster",tiles:["https://services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Boundaries_and_Places/MapServer/tile/{z}/{y}/{x}"],tileSize:256,attribution:"Esri"}}:{esri_satellite:t},layers:e?[{id:"esri_satellite",type:"raster",source:"esri_satellite"},{id:"esri_labels",type:"raster",source:"esri_labels",paint:{"raster-opacity":.92}}]:[{id:"esri_satellite",type:"raster",source:"esri_satellite"}],glyphs:"https://demotiles.maplibre.org/font/{fontstack}/{range}.pbf"})}let f=[{id:"dark",label:"Dark",styleUrl:"https://basemaps.cartocdn.com/gl/dark-matter-gl-style/style.json",defaultOn:!0,enabled:!0},{id:"light",label:"Light",styleUrl:"https://basemaps.cartocdn.com/gl/voyager-gl-style/style.json",enabled:!0},{id:"satellite",label:"Satellite",styleUrl:y?"https://api.maptiler.com/maps/satellite/style.json?key=".concat(g):"data:application/json,".concat(encodeURIComponent(x(!1))),enabled:!0},{id:"hybrid",label:"Hybrid",styleUrl:y?"https://api.maptiler.com/maps/hybrid/style.json?key=".concat(g):"data:application/json,".concat(encodeURIComponent(x(!0))),enabled:!0}],b=[{id:"statewide_hydrology",label:"Statewide hydrology",group:"MRI Overlays",defaultOn:!0,source:{id:"statewide-hydrology-source",type:"geojson",data:"https://hydro.nationalmap.gov/arcgis/rest/services/nhd/MapServer/2/query?where=1%3D1&geometry=-116.2,44.2,-104,49.2&geometryType=esriGeometryEnvelope&inSR=4326&spatialRel=esriSpatialRelIntersects&outFields=GNIS_NAME&returnGeometry=true&geometryPrecision=4&maxAllowableOffset=0.005&f=geojson"},layers:["statewide-hydrology-line"],locked:!0},{id:"public_federal",label:"Federal",group:"Public Lands",defaultOn:!1,source:{id:"public-lands-federal-source",type:"raster",tiles:["https://gis.blm.gov/arcgis/rest/services/lands/BLM_Natl_SMA_Cached_without_PriUnk/MapServer/tile/{z}/{y}/{x}"],tileSize:256,attribution:"BLM Surface Management Agency"},layers:["public-lands-federal-layer"],minZoomNote:"Visible at zoom 7+"},{id:"public_state",label:"State",group:"Public Lands",defaultOn:!1,source:{id:"public-lands-state-source",type:"none"},layers:[],comingSoon:!0},{id:"access_fishing_sites",label:"Fishing Access Sites (MT FWP)",group:"Access",defaultOn:!1,source:{id:"access-fishing-sites-source",type:"geojson",data:"https://fwp-gis.mt.gov/arcgis/rest/services/fwplnd/fwpLands/MapServer/1/query?where=1%3D1&outFields=NAME&returnGeometry=true&f=geojson"},layers:["access-fishing-sites-layer"]},{id:"mri_river_lines",label:"Rivers",group:"MRI Overlays",defaultOn:!0,source:{id:"selected-river-source",type:"geojson"},layers:["rivers-main","rivers-hit"]},{id:"mri_selected_highlight",label:"Selected river highlight",group:"MRI Overlays",defaultOn:!0,source:{id:"selected-river-source",type:"geojson"},layers:["rivers-halo","rivers-casing"]},{id:"mri_river_markers",label:"River markers",group:"MRI Overlays",defaultOn:!0,source:{id:"rivers-source",type:"geojson"},layers:["rivers-unclustered","rivers-selected-halo","rivers-selected-core"],locked:!0},{id:"mri_score_coloring",label:"Score coloring",group:"MRI Overlays",defaultOn:!1,source:{id:"rivers-source",type:"geojson"},layers:["rivers-unclustered"]},{id:"mri_labels",label:"Labels",group:"MRI Overlays",defaultOn:!0,source:{id:"basemap-style",type:"none"},layers:["selected-river-label"]},{id:"hydro_flow_magnitude",label:"Flow magnitude",group:"MRI Overlays",defaultOn:!1,source:{id:"rivers-source",type:"geojson"},layers:["hydro-flow-magnitude-layer"]},{id:"hydro_change_indicator",label:"48h change indicator",group:"MRI Overlays",defaultOn:!1,source:{id:"rivers-source",type:"geojson"},layers:["hydro-change-indicator-layer"]},{id:"hydro_temp_stress",label:"Temp stress flag",group:"MRI Overlays",defaultOn:!1,source:{id:"rivers-source",type:"geojson"},layers:["hydro-temp-stress-layer"]}],_="mri.layers.v2",j=null!==(i=null===(l=f.find(e=>e.defaultOn))||void 0===l?void 0:l.id)&&void 0!==i?i:"dark";function w(){return b.reduce((e,t)=>(e[t.id]=t.defaultOn,e),{})}let N=["Public Lands","Access","MRI Overlays"],L="montana-river-map-labels";function S(){let e=localStorage.getItem(L);return null===e||"true"===e}function k(e){let{map:t}=e,[r,l]=(0,a.useState)(S);return(0,a.useEffect)(()=>{var e;if(!t)return;let l=null===(e=t.getStyle())||void 0===e?void 0:e.layers;if(Array.isArray(l))for(let e of l)e.id.toLowerCase().includes("label")&&t.setLayoutProperty(e.id,"visibility",r?"visible":"none")},[t,r]),(0,s.jsx)("div",{className:"pointer-events-none absolute right-3 bottom-3 z-30 flex flex-col gap-2 rounded-lg p-1.5",children:(0,s.jsxs)("label",{className:"pointer-events-auto flex items-center gap-2 px-2 py-1.5 rounded cursor-pointer hover:bg-white/5 text-sm text-slate-200 bg-slate-900/90 backdrop-blur-sm border border-white/10",children:[(0,s.jsx)("input",{type:"checkbox",checked:r,onChange:()=>{let e=!r;l(e),localStorage.setItem(L,String(e))},className:"rounded border-slate-500 bg-slate-800 text-sky-500"}),"Labels"]})})}let M=[-110.9,46.9],R={HOT:"#dc2626",GOOD:"#16a34a",FAIR:"#ca8a04",TOUGH:"#64748b"},O="rivers-source",F="rivers-unclustered",C="rivers-selected-halo",z="rivers-selected-core",E="selected-river-source",T="rivers-hit",A="rivers-halo",P="rivers-casing",I="rivers-main",G="selected-river-label",D="statewide-hydrology-source",H="statewide-hydrology-line",U="public-lands-federal-source",B="public-lands-federal-layer",W="access-fishing-sites-source",Y="access-fishing-sites-layer",Z="hydro-flow-magnitude-layer",q="hydro-change-indicator-layer",V="hydro-temp-stress-layer",J="river_id";function X(){return["to-string",["coalesce",["get",J],["get","river_uuid"],["get","riverId"],["get","id"],""]]}function K(e){let t=[];for(let c of e){var r,l,i,s,a,n,o;let e=null!==(r=c.lat)&&void 0!==r?r:c.latitude,d=null!==(l=c.lng)&&void 0!==l?l:c.longitude,u=null!=e&&null!=d?[d,e]:p[c.river_id];u&&t.push({type:"Feature",geometry:{type:"Point",coordinates:u},properties:{river_id:c.river_id,river_name:c.river_name,bite_tier:null!==(i=c.bite_tier)&&void 0!==i?i:null,fishability_score:null!==(s=c.fishability_score_calc)&&void 0!==s?s:null,flow_ratio_calc:null!==(a=c.flow_ratio_calc)&&void 0!==a?a:null,change_48h_pct_calc:null!==(n=c.change_48h_pct_calc)&&void 0!==n?n:null,water_temp_f:null!==(o=c.water_temp_f)&&void 0!==o?o:null}})}return{type:"FeatureCollection",features:t}}function Q(e,t){var r;let l=K(t),i=e.getSource(O);if(!i){e.addSource(O,{type:"geojson",data:l,cluster:!1,generateId:!0});return}null===(r=i.setData)||void 0===r||r.call(i,l)}function $(e){e.getLayer(F)||e.addLayer({id:F,type:"circle",source:O,filter:["==",["geometry-type"],"Point"],paint:{"circle-color":["case",["==",["get","bite_tier"],"HOT"],R.HOT,["==",["get","bite_tier"],"GOOD"],R.GOOD,["==",["get","bite_tier"],"FAIR"],R.FAIR,["==",["get","bite_tier"],"TOUGH"],R.TOUGH,"#94a3b8"],"circle-radius":["case",["boolean",["feature-state","hover"],!1],8,6],"circle-stroke-color":"rgba(255,255,255,0.92)","circle-stroke-width":["case",["boolean",["feature-state","hover"],!1],2.5,2],"circle-opacity":.95}}),e.getLayer(C)||e.addLayer({id:C,type:"circle",source:O,filter:["==",["get","river_id"],"__none__"],paint:{"circle-color":"rgba(56, 189, 248, 0.30)","circle-radius":15}}),e.getLayer(z)||e.addLayer({id:z,type:"circle",source:O,filter:["==",["get","river_id"],"__none__"],paint:{"circle-color":"rgba(255,255,255,0.98)","circle-radius":6,"circle-stroke-color":"rgba(56, 189, 248, 0.98)","circle-stroke-width":2}})}function ee(e,t,r,l){let i=null!=t?t:"__none__",s=r?"visible":"none";for(let t of[F,C,z])e.getLayer(t)&&e.setLayoutProperty(t,"visibility",s);if(e.getLayer(C)&&e.setFilter(C,["==",["get","river_id"],i]),e.getLayer(z)&&e.setFilter(z,["==",["get","river_id"],i]),!e.getLayer(F))return;let a=l?["case",["==",["get","bite_tier"],"HOT"],R.HOT,["==",["get","bite_tier"],"GOOD"],R.GOOD,["==",["get","bite_tier"],"FAIR"],R.FAIR,["==",["get","bite_tier"],"TOUGH"],R.TOUGH,"#94a3b8"]:"#94a3b8";e.setPaintProperty(F,"circle-color",a),e.setPaintProperty(F,"circle-opacity",t?["case",["==",["get","river_id"],t],.95,.38]:.95)}function et(e,t,r,l,i,s,a){var n;let o=i&&s;if(!t||!i&&!o){e.getLayer(G)&&e.removeLayer(G),e.getLayer(T)&&e.removeLayer(T),e.getLayer(I)&&e.removeLayer(I),e.getLayer(P)&&e.removeLayer(P),e.getLayer(A)&&e.removeLayer(A),e.getSource(E)&&e.removeSource(E);return}let c=t?"FeatureCollection"===t.type||"Feature"===t.type?t:"LineString"===t.type||"MultiLineString"===t.type?{type:"Feature",properties:{},geometry:t}:t:null;if(!c)return;let d=function(e,t,r){if(!r&&!t)return e;if("Feature"===e.type){var l;let i={...null!==(l=e.properties)&&void 0!==l?l:{}},s=null!=i.river_id||null!=i.river_uuid||null!=i.riverId||null!=i.id;return{...e,properties:{...i,...!s&&t?{river_id:t}:{},...r?{name:r,river_name:r}:{}}}}return"FeatureCollection"===e.type?{...e,features:e.features.map(e=>({...e,properties:(()=>{var l;let i={...null!==(l=e.properties)&&void 0!==l?l:{}},s=null!=i.river_id||null!=i.river_uuid||null!=i.riverId||null!=i.id;return{...i,...!s&&t?{river_id:t}:{},...r?{name:r,river_name:r}:{}}})()}))}:{type:"Feature",properties:{...t?{river_id:t}:{},...r?{name:r,river_name:r}:{}},geometry:e}}(c,r,l),u=r?String(r):"",m=function(e){let t=e?String(e):"";return t?["==",X(),t]:["==",["literal",1],["literal",0]]}(u),h=["==",["literal",u],""],v=["==",X(),u],p=e.getSource(E);p?null===(n=p.setData)||void 0===n||n.call(p,d):e.addSource(E,{type:"geojson",data:d}),o&&!e.getLayer(A)?e.addLayer({id:A,type:"line",source:E,filter:m,layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"rgba(255,255,255,0.25)","line-width":7,"line-blur":.5,"line-opacity":1}}):!o&&e.getLayer(A)&&e.removeLayer(A),o&&!e.getLayer(P)?e.addLayer({id:P,type:"line",source:E,filter:m,layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"rgba(0,0,0,0.35)","line-width":5,"line-opacity":1}}):!o&&e.getLayer(P)&&e.removeLayer(P),i&&!e.getLayer(I)?e.addLayer({id:I,type:"line",source:E,minzoom:4,maxzoom:24,layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":["case",v,"#2c6e8f","#4a6a78"],"line-width":["interpolate",["linear"],["zoom"],5,["case",v,3.1,2.6],7,["case",v,3.9,3.2],9,["case",v,5,4.2],11,["case",v,6.3,5.4]],"line-opacity":["case",h,.75,v,.95,.35]}}):!i&&e.getLayer(I)&&e.removeLayer(I),i&&!e.getLayer(T)?e.addLayer({id:T,type:"line",source:E,minzoom:4,maxzoom:24,layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"rgba(0,0,0,0)","line-width":["interpolate",["linear"],["zoom"],5,16,7,18,9,22,11,26],"line-opacity":0}}):!i&&e.getLayer(T)&&e.removeLayer(T),e.getLayer(A)&&e.setFilter(A,m),e.getLayer(P)&&e.setFilter(P,m),e.getLayer(I)&&(e.setPaintProperty(I,"line-color",["case",v,"#2c6e8f","#4a6a78"]),e.setPaintProperty(I,"line-width",["interpolate",["linear"],["zoom"],5,["case",v,3.1,2.6],7,["case",v,3.9,3.2],9,["case",v,5,4.2],11,["case",v,6.3,5.4]]),e.setPaintProperty(I,"line-opacity",["case",h,.75,v,.95,.35])),a&&!e.getLayer(G)?e.addLayer({id:G,type:"symbol",source:E,minzoom:8,layout:{"symbol-placement":"line","text-field":["coalesce",["get","name"],["get","river_name"],""],"text-size":["interpolate",["linear"],["zoom"],8,10,11,12,13,13]},paint:{"text-color":"rgba(236, 242, 247, 0.85)","text-halo-color":"rgba(30, 46, 51, 0.85)","text-halo-width":1}}):!a&&e.getLayer(G)&&e.removeLayer(G);try{e.getLayer(H)&&e.getLayer(A)&&e.moveLayer(A),e.getLayer(A)&&e.getLayer(F)&&e.moveLayer(A,F),e.getLayer(P)&&e.getLayer(F)&&e.moveLayer(P,F),e.getLayer(I)&&e.getLayer(F)&&e.moveLayer(I,F),e.getLayer(T)&&e.getLayer(F)&&e.moveLayer(T,F),e.getLayer(G)&&e.getLayer(F)&&e.moveLayer(G,F),e.getLayer(F)&&e.moveLayer(F),e.getLayer(C)&&e.moveLayer(C),e.getLayer(z)&&e.moveLayer(z)}catch(e){}}function er(e,t){if(t){e.getSource(D)||e.addSource(D,{type:"geojson",data:"https://hydro.nationalmap.gov/arcgis/rest/services/nhd/MapServer/2/query?where=1%3D1&geometry=-116.2,44.2,-104,49.2&geometryType=esriGeometryEnvelope&inSR=4326&spatialRel=esriSpatialRelIntersects&outFields=GNIS_NAME&returnGeometry=true&geometryPrecision=4&maxAllowableOffset=0.005&f=geojson"}),e.getLayer(H)||e.addLayer({id:H,type:"line",source:D,paint:{"line-color":"#2C3E44","line-width":["interpolate",["linear"],["zoom"],5,.35,8,.55,11,.9],"line-opacity":.7}});try{e.getLayer(A)?e.moveLayer(H,A):e.getLayer(F)&&e.moveLayer(H,F)}catch(e){}return}e.getLayer(H)&&e.removeLayer(H)}function el(e,t){if(t){e.getSource(U)||e.addSource(U,{type:"raster",tiles:["https://gis.blm.gov/arcgis/rest/services/lands/BLM_Natl_SMA_Cached_without_PriUnk/MapServer/tile/{z}/{y}/{x}"],tileSize:256,attribution:"BLM Surface Management Agency"}),e.getLayer(B)||e.addLayer({id:B,type:"raster",source:U,minzoom:7,paint:{"raster-opacity":.24,"raster-saturation":-.55,"raster-contrast":-.2,"raster-brightness-min":.15,"raster-brightness-max":.82}});return}e.getLayer(B)&&e.removeLayer(B)}function ei(e,t){if(t){e.getSource(W)||e.addSource(W,{type:"geojson",data:"https://fwp-gis.mt.gov/arcgis/rest/services/fwplnd/fwpLands/MapServer/1/query?where=1%3D1&outFields=NAME&returnGeometry=true&f=geojson"}),e.getLayer(Y)||e.addLayer({id:Y,type:"circle",source:W,paint:{"circle-color":"#38bdf8","circle-radius":4,"circle-stroke-color":"#e2e8f0","circle-stroke-width":1.25,"circle-opacity":.95}});return}e.getLayer(Y)&&e.removeLayer(Y)}function es(e,t,r,l){t?e.getLayer(Z)||e.addLayer({id:Z,type:"circle",source:O,filter:["==",["geometry-type"],"Point"],paint:{"circle-color":["interpolate",["linear"],["coalesce",["get","flow_ratio_calc"],1],.4,"#60a5fa",.8,"#34d399",1,"#fbbf24",1.5,"#f97316",2,"#ef4444"],"circle-radius":["interpolate",["linear"],["zoom"],5,2.5,9,4.2,12,5.2],"circle-opacity":.8}}):e.getLayer(Z)&&e.removeLayer(Z),r?e.getLayer(q)||e.addLayer({id:q,type:"symbol",source:O,filter:["==",["geometry-type"],"Point"],layout:{"text-field":["case",[">",["coalesce",["get","change_48h_pct_calc"],0],12],"▲",["<",["coalesce",["get","change_48h_pct_calc"],0],-12],"▼","•"],"text-size":["interpolate",["linear"],["zoom"],6,9,10,12],"text-offset":[0,1.3]},paint:{"text-color":["case",[">",["coalesce",["get","change_48h_pct_calc"],0],12],"#22c55e",["<",["coalesce",["get","change_48h_pct_calc"],0],-12],"#ef4444","#94a3b8"],"text-halo-color":"rgba(15,23,42,0.9)","text-halo-width":1}}):e.getLayer(q)&&e.removeLayer(q),l?e.getLayer(V)||e.addLayer({id:V,type:"circle",source:O,filter:["all",["==",["geometry-type"],"Point"],[">=",["coalesce",["get","water_temp_f"],0],67]],paint:{"circle-color":"#ef4444","circle-radius":["interpolate",["linear"],["zoom"],6,5,10,7.5],"circle-stroke-color":"rgba(255,255,255,0.95)","circle-stroke-width":1.2,"circle-opacity":.8}}):e.getLayer(V)&&e.removeLayer(V);try{e.getLayer(Z)&&e.getLayer(F)&&e.moveLayer(Z,F),e.getLayer(q)&&e.getLayer(F)&&e.moveLayer(q,F),e.getLayer(V)&&e.getLayer(F)&&e.moveLayer(V,F)}catch(e){}}function ea(e,t){var r;let l=e.getStyle(),i=t?"visible":"none";for(let t of null!==(r=l.layers)&&void 0!==r?r:[]){if(!t.id)continue;let r=t.id.toLowerCase();if(r.includes("label")||r.includes("place")||r.includes("poi"))try{e.setLayoutProperty(t.id,"visibility",i)}catch(e){}}}function en(e){let{rivers:t,selectedRiver:r,selectedRiverName:l,selectedRiverId:i,selectedRiverGeojson:n,riverLinesGeojson:c,layerState:d,onSelectRiver:u,className:m,initialStyleUrl:h,onMapReady:v}=e,g=null!=d?d:w(),y=(0,a.useRef)(null),x=(0,a.useRef)(null),f=(0,a.useRef)(t),b=(0,a.useRef)(u),_=(0,a.useRef)(l),j=(0,a.useRef)(i),N=(0,a.useRef)(n),L=(0,a.useRef)(null!=c?c:null),S=(0,a.useRef)(g),R=(0,a.useRef)(null),E=(0,a.useRef)(null),[G,D]=(0,a.useState)(!1);f.current=t,b.current=u,_.current=l,j.current=i,N.current=n,L.current=null!=c?c:null,S.current=g;let H=(0,a.useCallback)(e=>{var t;!function(e){var t,r;let l=(null!==(t=e.getStyle().layers)&&void 0!==t?t:[]).filter(e=>"raster"===e.type),i=0;for(let t of l){let l=null!==(r=t.id)&&void 0!==r?r:"",s=l.toLowerCase();if(!s.includes("label")&&!s.includes("reference")&&!s.includes("boundaries")&&l!==B)try{e.setPaintProperty(l,"raster-saturation",-.15),e.setPaintProperty(l,"raster-brightness-min",.05),e.setPaintProperty(l,"raster-brightness-max",.95),i+=1}catch(e){}}0===i&&l.length>0&&console.log("MAP RASTER LAYERS",l.map(e=>({id:e.id,type:e.type})))}(e),Q(e,f.current),$(e),ee(e,j.current,!0,S.current.mri_score_coloring),et(e,null!==(t=L.current)&&void 0!==t?t:N.current,j.current,_.current,S.current.mri_river_lines,S.current.mri_selected_highlight,S.current.mri_labels),er(e,S.current.statewide_hydrology),el(e,S.current.public_federal),ei(e,S.current.access_fishing_sites),es(e,S.current.hydro_flow_magnitude,S.current.hydro_change_indicator,S.current.hydro_temp_stress),ea(e,S.current.mri_labels)},[]),U=(0,a.useCallback)(()=>{if(!y.current)return;let e=new(o()).Map({container:y.current,style:null!=h?h:"https://basemaps.cartocdn.com/gl/dark-matter-gl-style/style.json",center:M,zoom:5.2,pitch:22,bearing:-5});e.addControl(new(o()).NavigationControl,"top-right"),x.current=e,e.on("load",()=>{var t;D(!0),null==v||v(e),H(e),console.log("MAP STYLE LAYERS",(null!==(t=e.getStyle().layers)&&void 0!==t?t:[]).map(e=>({id:e.id,type:e.type}))),console.log("RIVER/STATION LAYERS",{riverHit:T,riverMain:I,riverCasing:P,riverHalo:A,stationLayers:[F,C,z]}),e.resize()}),e.__mriHandlers||(e.__mriHandlers=!0,e.on("click",F,e=>{var t,r;e.originalEvent&&"cancelBubble"in e.originalEvent&&(e.originalEvent.cancelBubble=!0);let l=null===(t=e.features)||void 0===t?void 0:t[0],i=null==l?void 0:null===(r=l.properties)||void 0===r?void 0:r.river_id;if(!i)return;let s=f.current.find(e=>e.river_id===i);s&&b.current(s)}),e.on("click",T,t=>{var r,l,i,s;if(!S.current.mri_river_lines||e.queryRenderedFeatures(t.point,{layers:[F,C,z]}).length>0)return;let a=null===(r=t.features)||void 0===r?void 0:r[0];console.log("river click props",null==a?void 0:a.properties);let n=null!==(s=null!==(i=function(e){var t,r,l,i;if(!e)return null;let s=null!==(i=null!==(l=null!==(r=null!==(t=e[J])&&void 0!==t?t:e.river_uuid)&&void 0!==r?r:e.riverId)&&void 0!==l?l:e.id)&&void 0!==i?i:null;if(null==s)return null;let a=String(s).trim();return a.length>0?a:null}(null!==(l=null==a?void 0:a.properties)&&void 0!==l?l:null))&&void 0!==i?i:j.current)&&void 0!==s?s:void 0;if(!n)return;let o=f.current.find(e=>e.river_id===n||e.slug===n);o&&(E.current=null,b.current(o))}),e.on("mouseenter",T,()=>{e.getCanvas().style.cursor="pointer"}),e.on("mouseleave",T,()=>{e.getCanvas().style.cursor=""}),e.on("mousemove",F,t=>{var r;e.getCanvas().style.cursor="pointer";let l=null===(r=t.features)||void 0===r?void 0:r[0],i=null==l?void 0:l.id;if(null!=i){if(null!=R.current&&R.current!==i)try{e.setFeatureState({source:O,id:R.current},{hover:!1})}catch(e){}R.current=i;try{e.setFeatureState({source:O,id:i},{hover:!0})}catch(e){}}}),e.on("mouseleave",F,()=>{if(e.getCanvas().style.cursor="",null!=R.current)try{e.setFeatureState({source:O,id:R.current},{hover:!1})}catch(e){}R.current=null}))},[h,v,H]);(0,a.useEffect)(()=>(U(),()=>{var e;null===(e=x.current)||void 0===e||e.remove(),x.current=null,E.current=null}),[U]),(0,a.useEffect)(()=>{let e=x.current;if(!e||!y.current)return;let t=()=>e.resize();window.addEventListener("resize",t);let r=new ResizeObserver(()=>e.resize());return r.observe(y.current),()=>{window.removeEventListener("resize",t),r.disconnect()}},[G]);let W=t.map(e=>e.river_id).join(",");return(0,a.useEffect)(()=>{let e=x.current;if(e&&G&&("function"!=typeof e.isStyleLoaded||e.isStyleLoaded())&&(Q(e,t),$(e),ee(e,i,!0,g.mri_score_coloring),!i)){let r=K(t);if(r.features.length){let t=new(o()).LngLatBounds(r.features[0].geometry.coordinates,r.features[0].geometry.coordinates);for(let e of r.features)t.extend(e.geometry.coordinates);e.fitBounds(t,{padding:60,duration:450})}}},[W,G,t,i,g.mri_score_coloring]),(0,a.useEffect)(()=>{let e=x.current;if(!e||!G||"function"==typeof e.isStyleLoaded&&!e.isStyleLoaded())return;if(console.log("SELECTED RIVER STYLE UPDATE",i),ee(e,i,!0,g.mri_score_coloring),et(e,null!=c?c:n,i,l,g.mri_river_lines,g.mri_selected_highlight,g.mri_labels),!i){E.current=null;return}if(E.current===i)return;E.current=i;let t=(null==r?void 0:r.lat)!=null&&(null==r?void 0:r.lng)!=null?[r.lng,r.lat]:p[i];if(n){let t=function(e){let t=[],r=e=>{if("Point"===e.type)t.push(e.coordinates);else if("LineString"===e.type)for(let r of e.coordinates)t.push(r);else if("MultiLineString"===e.type)for(let r of e.coordinates)for(let e of r)t.push(e);else if("Polygon"===e.type)for(let r of e.coordinates)for(let e of r)t.push(e);else if("MultiPoint"===e.type)for(let r of e.coordinates)t.push(r)};if("geometry"in e&&e.geometry)r(e.geometry);else if("coordinates"in e)r(e);else if("features"in e)for(let t of e.features)t.geometry&&r(t.geometry);if(!t.length)return null;let l=t.map(e=>e[0]),i=t.map(e=>e[1]);return[Math.min(...l),Math.min(...i),Math.max(...l),Math.max(...i)]}(n);if(t&&e.fitBounds){e.fitBounds([[t[0],t[1]],[t[2],t[3]]],{padding:60,duration:700,essential:!0});return}}t&&e.flyTo({center:t,zoom:9.5,duration:667,curve:1.5,essential:!0})},[i,n,c,r,g.mri_river_lines,g.mri_selected_highlight,g.mri_labels,g.mri_score_coloring,G]),(0,a.useEffect)(()=>{let e=x.current;e&&G&&("function"!=typeof e.isStyleLoaded||e.isStyleLoaded())&&(er(e,g.statewide_hydrology),el(e,g.public_federal),ei(e,g.access_fishing_sites),es(e,g.hydro_flow_magnitude,g.hydro_change_indicator,g.hydro_temp_stress),ea(e,g.mri_labels))},[G,g.statewide_hydrology,g.public_federal,g.access_fishing_sites,g.hydro_flow_magnitude,g.hydro_change_indicator,g.hydro_temp_stress,g.mri_labels]),(0,a.useEffect)(()=>{let e=x.current;if(!e||!G)return;let t=()=>{H(e)};return e.on("load",t),()=>{e.off("load",t)}},[G,H]),(0,s.jsx)("div",{id:"map",ref:y,className:"absolute inset-0 h-full w-full min-h-0 [&_.maplibregl-marker]:cursor-pointer ".concat(null!=m?m:"").trim(),style:{position:"absolute",inset:0,height:"100%",width:"100%",minHeight:320},"aria-label":"Montana river map",children:G&&x.current&&(0,s.jsx)(k,{map:x.current})})}var eo=r(3053);let ec="https://relkyvqwmfbmzzlqypmu.supabase.co",ed="sb_publishable_PxejFrRRvhrHai_FtjAGoA_rlM9S9_e",eu=ec&&ed?(0,eo.eI)(ec,ed):null;async function em(e){var t;if(!eu)return null;let{data:r,error:l}=await eu.from("river_geoms").select("geom").eq("river_id",e).single();return l||!r?null:null!==(t=r.geom)&&void 0!==t?t:null}async function eh(e){if(!e||!eu)return null;let{data:t,error:r}=await eu.rpc("get_river_geojson_by_slug",{p_slug:e});return r?(console.error("[fetchRiverGeojsonBrowser] rpc error:",r),null):null!=t?t:null}function ev(e,t,r){return Math.max(t,Math.min(r,e))}function ep(e){let{tier:t}=e,r="Good"===t||"HOT"===t||"GOOD"===t?"bg-green-500":"Fair"===t||"FAIR"===t?"bg-yellow-500":"bg-slate-400";return(0,s.jsxs)("span",{className:"inline-flex items-center gap-2 text-xs font-semibold text-white/90",children:[(0,s.jsx)("span",{className:"h-2.5 w-2.5 rounded-full ".concat(r)}),"HOT"===t||"GOOD"===t?"Good":"FAIR"===t?"Fair":"TOUGH"===t?"Tough":null!=t?t:"—"]})}function eg(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return null==e||Number.isNaN(e)?"—":Number(e).toFixed(t)}function ey(e){if(!e)return"—";let t=new Date(e);return Number.isNaN(t.getTime())?"—":t.toLocaleString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0,timeZone:"America/Denver"})}function ex(e){var t,r,l,i,n,g,y,x,L,S;let{rivers:k,dateLabel:M=new Date().toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric",year:"numeric"})}=e,[R,O]=(0,a.useState)(""),[F,C]=(0,a.useState)("All"),[z,E]=(0,a.useState)(null),[T,A]=(0,a.useState)(!0),[P,I]=(0,a.useState)(0),[G,D]=(0,a.useState)(!1),H=(0,a.useRef)(null),[U,B]=(0,a.useState)(null),[W,Y]=(0,a.useState)(null),Z=(0,a.useRef)(null),[q,V]=(0,a.useState)(!1),[J,X]=(0,a.useState)(!1),[K,Q]=(0,a.useState)(!1),[$,ee]=(0,a.useState)(!1),[et,er]=(0,a.useState)(j),[el,ei]=(0,a.useState)(w()),es=(0,a.useMemo)(()=>Object.fromEntries(f.map(e=>[e.id,e])),[]),ea=(0,a.useMemo)(()=>{let e=R.trim().toLowerCase();return(null!=k?k:[]).filter(t=>{var r,l;let i=!e||(null!==(r=t.river_name)&&void 0!==r?r:"").toLowerCase().includes(e)||(null!==(l=t.gauge_label)&&void 0!==l?l:"").toLowerCase().includes(e),s="HOT"===t.bite_tier||"GOOD"===t.bite_tier?"Good":"FAIR"===t.bite_tier?"Fair":"TOUGH"===t.bite_tier?"Tough":"";return i&&("All"===F||s===F)}).sort((e,t)=>{var r,l;return(null!==(r=t.fishability_score_calc)&&void 0!==r?r:-999)-(null!==(l=e.fishability_score_calc)&&void 0!==l?l:-999)})},[k,R,F]),eo=(0,a.useMemo)(()=>{var e,t;return z&&null!==(t=null!==(e=ea.find(e=>e.river_id===z))&&void 0!==e?e:k.find(e=>e.river_id===z))&&void 0!==t?t:null},[ea,k,z]),ec=(0,a.useMemo)(()=>(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Date,t=e.getMonth();return 11===t||t<=1?{season:"Winter",likelyBugs:"Midges, Blue-Winged Olives (low activity windows)",recommendedApproach:"Fish slow seams and tailouts with small nymphs or midge dries during warmest hours."}:t>=2&&t<=4?{season:"Spring",likelyBugs:"Skwala, Baetis, early caddis",recommendedApproach:"Target afternoon windows; mix dry-dropper with short nymph rigs as flows stabilize."}:t>=5&&t<=7?{season:"Summer",likelyBugs:"PMD, caddis, stoneflies, terrestrials",recommendedApproach:"Cover pocket water and banks with attractor dries, then switch to nymphs when surface slows."}:{season:"Fall",likelyBugs:"Baetis, mahogany duns, midges",recommendedApproach:"Fish midday hatches and focus on softer edges with emergers, small dries, and light nymph rigs."}})(),[]),ed=(0,a.useMemo)(()=>eo?function(e){var t,r,l;let i=e.flow_ratio_calc,s=e.change_48h_pct_calc,a=e.water_temp_f,n=null!=e.wind_am_mph&&null!=e.wind_pm_mph?(e.wind_am_mph+e.wind_pm_mph)/2:null!==(r=null!==(t=e.wind_am_mph)&&void 0!==t?t:e.wind_pm_mph)&&void 0!==r?r:null,o=null==i||i<=0?null:Math.round(ev(30-14*Math.abs(Math.log2(i)),0,30));return{flowScore:o,stabilityScore:null==s?null:Math.round(ev(25-.8*Math.abs(s),0,25)),thermalScore:null==a?null:Math.round(ev(25-1.2*Math.abs(a-56),0,25)),windPenalty:null==n?null:Math.round(ev(1.2*n,0,20)),totalScore:null!==(l=e.fishability_score_calc)&&void 0!==l?l:null}}(eo):null,[eo]),eu=(0,a.useMemo)(()=>"Summer"===ec.season?"High":"Spring"===ec.season||"Fall"===ec.season?"Moderate":"Low",[ec.season]),ex=(0,a.useMemo)(()=>{let e=0;for(let i of k){var t,r,l;let s=null!==(l=null!==(r=null!==(t=i.source_flow_observed_at)&&void 0!==t?t:i.source_temp_observed_at)&&void 0!==r?r:i.updated_at)&&void 0!==l?l:null;if(!s)continue;let a=new Date(s).getTime();!Number.isNaN(a)&&a>e&&(e=a)}return e>0?new Date(e).toISOString():null},[k]);(0,a.useEffect)(()=>{let e=!1;return(async function(){var t,r,l;if(!z){B(null);return}let i=null!==(t=ea.find(e=>e.river_id===z))&&void 0!==t?t:k.find(e=>e.river_id===z),s=null!==(l=null!==(r=null==i?void 0:i.slug)&&void 0!==r?r:null==i?void 0:i.river_id)&&void 0!==l?l:z,a=await eh(s);if(e)return;if(a){B(a);return}let n=await em(z);e||B(n?{type:"Feature",geometry:n,properties:{river_id:z}}:null)})().catch(()=>{e||B(null)}),()=>{e=!0}},[z,ea,k]),(0,a.useEffect)(()=>{let e=!1;return(async function(){let t=k.map(async e=>{var t;let r=null!==(t=e.slug)&&void 0!==t?t:e.river_id,l=await eh(r);return l?{river:e,gj:l}:null}),r=await Promise.all(t);if(e)return;let l=[];for(let e of r){var i,s,a;if(!(null==e?void 0:e.gj))continue;let t=e.river.river_id,r=e.river.river_name;if("FeatureCollection"===e.gj.type){for(let a of null!==(i=e.gj.features)&&void 0!==i?i:[])(null==a?void 0:a.geometry)&&l.push({type:"Feature",geometry:a.geometry,properties:{...null!==(s=a.properties)&&void 0!==s?s:{},river_id:t,river_name:r,name:r}});continue}if("Feature"===e.gj.type){e.gj.geometry&&l.push({type:"Feature",geometry:e.gj.geometry,properties:{...null!==(a=e.gj.properties)&&void 0!==a?a:{},river_id:t,river_name:r,name:r}});continue}("LineString"===e.gj.type||"MultiLineString"===e.gj.type)&&l.push({type:"Feature",geometry:e.gj,properties:{river_id:t,river_name:r,name:r}})}Y({type:"FeatureCollection",features:l})})().catch(()=>{e||Y({type:"FeatureCollection",features:[]})}),()=>{e=!0}},[k]),(0,a.useEffect)(()=>{if(eo){V(!0);return}V(!1),Q(!1)},[eo]),(0,a.useEffect)(()=>{try{let e=localStorage.getItem(_);if(!e)return;let t=JSON.parse(e);if(t.basemap&&es[t.basemap]&&er(t.basemap),t.layerState){let e={...w()};for(let r of b)"boolean"==typeof t.layerState[r.id]&&(e[r.id]=t.layerState[r.id]);ei(e)}}catch(e){}},[es]),(0,a.useEffect)(()=>{try{localStorage.setItem(_,JSON.stringify({basemap:et,layerState:el}))}catch(e){}},[et,el]);let ef=null!==(r=null===(t=es[et])||void 0===t?void 0:t.styleUrl)&&void 0!==r?r:es[j].styleUrl;function eb(e){var t;let r="touches"in e?null===(t=e.touches[0])||void 0===t?void 0:t.clientY:e.clientY;if(null==r)return;H.current={startY:r,startSheetY:P},D(!0);let l=e=>{var t;let r="touches"in e?null===(t=e.touches[0])||void 0===t?void 0:t.clientY:e.clientY;if(null==r||!H.current)return;let l=r-H.current.startY;I(Math.max(0,Math.min(1,H.current.startSheetY+l/320)))},i=()=>{H.current&&(H.current=null,D(!1),I(e=>{let t=e>.45?1:0;return A(0===t),t}),document.removeEventListener("pointermove",l),document.removeEventListener("pointerup",i),document.removeEventListener("touchmove",l),document.removeEventListener("touchend",i))};document.addEventListener("pointermove",l),document.addEventListener("pointerup",i),document.addEventListener("touchmove",l,{passive:!0}),document.addEventListener("touchend",i)}function e_(e,t){ei(r=>({...r,[e]:t}))}let ej=(0,a.useMemo)(()=>N.map(e=>({group:e,layers:b.filter(t=>t.group===e)})),[]);return(0,s.jsxs)("div",{className:"relative h-[100dvh] w-full overflow-hidden bg-black",style:{position:"relative",height:"100dvh",width:"100%",overflow:"hidden",background:"#000"},children:[(0,s.jsx)("div",{className:"absolute inset-0",children:(0,s.jsx)(en,{rivers:ea,selectedRiver:eo,selectedRiverName:null!==(l=null==eo?void 0:eo.river_name)&&void 0!==l?l:null,selectedRiverId:z,selectedRiverGeojson:U,riverLinesGeojson:W,layerState:el,onSelectRiver:e=>E(e.river_id),className:"absolute inset-0",initialStyleUrl:ef,onMapReady:e=>{Z.current=e}})}),(0,s.jsx)("div",{className:"absolute left-3 top-3 z-30 hidden sm:block",children:(0,s.jsxs)("div",{className:"onx-glass w-[84px] overflow-hidden rounded-2xl",children:[(0,s.jsxs)("div",{className:"border-b border-white/10 px-3 py-3",children:[(0,s.jsx)("div",{className:"text-sm font-semibold leading-tight text-white",children:"MRI"}),(0,s.jsx)("div",{className:"text-[10px] leading-tight text-white/70",children:"Montana"})]}),(0,s.jsxs)("div",{className:"flex flex-col gap-2 p-2",children:[(0,s.jsx)("button",{className:"onx-iconbtn",title:"Map",children:"\uD83D\uDDFA️"}),(0,s.jsx)("button",{className:"onx-iconbtn",title:"Rivers",children:"\uD83C\uDFA3"}),(0,s.jsx)("button",{className:"onx-iconbtn",title:"Reports",children:"\uD83D\uDCC4"}),(0,s.jsx)("button",{className:"onx-iconbtn ".concat(J?"ring-2 ring-cyan-300/60":""),title:"Layers",onClick:()=>X(e=>!e),children:(0,s.jsx)(c.Z,{size:18,strokeWidth:2.5})})]})]})}),(0,s.jsx)("button",{className:"onx-iconbtn absolute bottom-24 right-3 z-30 sm:hidden",title:"Layers",onClick:()=>X(e=>!e),children:(0,s.jsx)(c.Z,{size:18,strokeWidth:2.5})}),(0,s.jsxs)("div",{className:"absolute left-3 right-3 top-3 z-30 sm:left-[108px] sm:right-[240px]",children:[(0,s.jsxs)("div",{className:"onx-glass flex items-center gap-2 rounded-2xl px-3 py-2",children:[(0,s.jsxs)("div",{className:"hidden text-xs font-semibold text-white/80 sm:block",children:[M," • ",ea.length," rivers"]}),(0,s.jsxs)("div",{className:"hidden text-[11px] text-white/70 sm:block",children:["Last pull ",ey(ex)," MT"]}),(0,s.jsx)("div",{className:"flex-1",children:(0,s.jsx)("input",{value:R,onChange:e=>O(e.target.value),placeholder:"Search rivers...",className:"w-full bg-transparent text-sm text-white placeholder:text-white/60 outline-none"})}),(0,s.jsx)("button",{className:"rounded-lg px-2 py-1 text-xs text-white/80 hover:text-white",onClick:()=>{O(""),C("All"),E(null)},children:"Reset"})]}),(0,s.jsx)("div",{className:"mt-2 flex flex-wrap gap-2",children:["All","Good","Fair","Tough"].map(e=>(0,s.jsx)("button",{onClick:()=>C(e),className:["h-9 rounded-full border px-3 text-sm font-medium backdrop-blur",F===e?"border-slate-200 bg-white/90 text-slate-900":"border-white/20 bg-slate-900/50 text-white hover:bg-slate-900/60"].join(" "),children:e},e))})]}),(0,s.jsxs)("div",{className:"absolute right-3 top-3 z-30 hidden flex-col gap-2 sm:flex",children:[(0,s.jsx)("button",{className:"onx-iconbtn",title:"Zoom in",onClick:function(){var e,t;null===(t=Z.current)||void 0===t||null===(e=t.zoomIn)||void 0===e||e.call(t,{duration:180})},children:(0,s.jsx)(d.Z,{size:18,strokeWidth:2.5})}),(0,s.jsx)("button",{className:"onx-iconbtn",title:"Zoom out",onClick:function(){var e,t;null===(t=Z.current)||void 0===t||null===(e=t.zoomOut)||void 0===e||e.call(t,{duration:180})},children:(0,s.jsx)(u.Z,{size:18,strokeWidth:2.5})}),(0,s.jsx)("button",{className:"onx-iconbtn",title:"Fit to rivers",onClick:function(){let e=Z.current;if(!e||!ea.length)return;let t=new(o()).LngLatBounds,r=!1;for(let e of ea){var l,i;let s=null!==(l=e.lat)&&void 0!==l?l:e.latitude,a=null!==(i=e.lng)&&void 0!==i?i:e.longitude,n=null!=s&&null!=a?[a,s]:p[e.river_id];n&&(t.extend(n),r=!0)}r&&!t.isEmpty()&&e.fitBounds(t,{padding:60,duration:450,essential:!0})},children:(0,s.jsx)(m.Z,{size:18,strokeWidth:2.5})}),(0,s.jsx)("button",{className:"onx-iconbtn",title:"Recenter Montana",onClick:function(){var e,t;null===(t=Z.current)||void 0===t||null===(e=t.flyTo)||void 0===e||e.call(t,{center:[-110.9,46.9],zoom:5.2,duration:450,essential:!0})},children:(0,s.jsx)(h.Z,{size:18,strokeWidth:2.5})}),(0,s.jsx)("button",{className:"onx-iconbtn",title:"Toggle river list",onClick:()=>{let e=!T;A(e),I(e?0:1)},children:(0,s.jsx)(v.Z,{size:18,strokeWidth:2.5})})]}),(0,s.jsx)("div",{className:["absolute left-3 top-16 z-40 w-[calc(100%-1rem)] sm:left-[108px] sm:top-[96px] sm:w-[360px]","transition-all duration-200",J?"translate-y-0 opacity-100":"pointer-events-none -translate-y-1 opacity-0"].join(" "),children:(0,s.jsxs)("div",{className:"onx-card rounded-2xl border border-slate-200/70 p-4 shadow-xl",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-sm font-semibold text-slate-900",children:"Layers"}),(0,s.jsx)("div",{className:"text-[11px] text-slate-500",children:"Map display controls"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("button",{className:"text-[11px] font-medium text-slate-500 hover:text-slate-700",onClick:function(){ei(w()),er(j)},children:"Reset layers"}),(0,s.jsx)("button",{className:"text-[11px] font-medium text-slate-500 hover:text-slate-700",onClick:()=>X(!1),children:"Close"})]})]}),(0,s.jsx)("div",{className:"mt-4 text-[11px] font-semibold uppercase tracking-wide text-slate-500",children:"Basemap"}),(0,s.jsx)("div",{className:"mt-2 grid grid-cols-2 gap-2",children:f.map(e=>{let t=et===e.id;return(0,s.jsxs)("button",{disabled:!e.enabled,className:["rounded-lg border px-2 py-1.5 text-xs font-medium",t?"border-slate-900 bg-slate-900 text-white":"border-slate-300 bg-white text-slate-700",e.enabled?"hover:bg-slate-50":"cursor-not-allowed opacity-55"].join(" "),onClick:()=>(function(e){var t,r,l,i;let s=es[e];if(!(null==s?void 0:s.enabled)||!s.styleUrl)return;er(e);let a=Z.current;if(!a)return;let n=null===(t=a.getCenter)||void 0===t?void 0:t.call(a),o=null===(r=a.getZoom)||void 0===r?void 0:r.call(a),c=null===(l=a.getBearing)||void 0===l?void 0:l.call(a),d=null===(i=a.getPitch)||void 0===i?void 0:i.call(a);a.setStyle(s.styleUrl),a.once("load",()=>{var e;try{n&&a.setCenter(n),null!=o&&a.setZoom(o),null!=c&&a.setBearing(c),null!=d&&a.setPitch(d)}catch(e){}null===(e=a.resize)||void 0===e||e.call(a)})})(e.id),children:[(0,s.jsx)("div",{children:e.label}),!e.enabled&&e.comingSoon?(0,s.jsx)("div",{className:"text-[10px] text-slate-500",children:"Coming soon"}):null]},e.id)})}),(0,s.jsxs)("div",{className:"mt-4",children:[(0,s.jsx)("div",{className:"text-[11px] font-semibold uppercase tracking-wide text-slate-500",children:"Core Layers"}),(0,s.jsx)("div",{className:"mt-2 space-y-2 rounded-xl border border-slate-200 bg-slate-50/80 p-2.5 text-xs text-slate-700",children:ej.flatMap(e=>e.layers).filter(e=>"mri_river_lines"===e.id||"mri_selected_highlight"===e.id).map(e=>(0,s.jsxs)("label",{className:"flex items-start justify-between gap-3",children:[(0,s.jsx)("span",{className:"leading-tight",children:(0,s.jsx)("span",{className:"block",children:e.label})}),(0,s.jsx)("input",{type:"checkbox",checked:el[e.id],onChange:t=>e_(e.id,t.target.checked)})]},e.id))})]}),(0,s.jsx)("div",{className:"mt-4",children:(0,s.jsx)("button",{className:"w-full rounded-lg border border-slate-200 bg-white px-2.5 py-2 text-left text-xs font-medium text-slate-700 hover:bg-slate-50",onClick:()=>ee(e=>!e),children:$?"Hide Advanced Layers":"Advanced Layers"})}),$?ej.map(e=>{let{group:t,layers:r}=e;return(0,s.jsxs)("div",{className:"mt-4",children:[(0,s.jsx)("div",{className:"text-[11px] font-semibold uppercase tracking-wide text-slate-500",children:t}),(0,s.jsx)("div",{className:"mt-2 space-y-2 rounded-xl border border-slate-200 bg-slate-50/80 p-2.5 text-xs text-slate-700",children:r.filter(e=>!e.locked&&"mri_river_lines"!==e.id&&"mri_selected_highlight"!==e.id).map(e=>{let t=el[e.id],r=!!e.comingSoon;return(0,s.jsxs)("label",{className:"flex items-start justify-between gap-3",children:[(0,s.jsxs)("span",{className:"leading-tight",children:[(0,s.jsx)("span",{className:"block",children:e.label}),e.minZoomNote?(0,s.jsx)("span",{className:"text-[10px] text-slate-500",children:e.minZoomNote}):null,e.comingSoon?(0,s.jsx)("span",{className:"text-[10px] text-slate-500",children:"Coming soon"}):null]}),(0,s.jsx)("input",{type:"checkbox",checked:t,disabled:r,onChange:t=>e_(e.id,t.target.checked)})]},e.id)})})]},t)}):null]})}),(0,s.jsx)("div",{className:"absolute right-3 top-[120px] z-30 hidden w-[280px] sm:block",children:q?(0,s.jsxs)("div",{className:"onx-card rounded-2xl p-4 shadow-xl",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("div",{className:"text-[11px] font-semibold uppercase tracking-wide text-slate-500",children:"River Detail"}),(0,s.jsx)("button",{className:"text-[11px] text-slate-500 hover:text-slate-700",onClick:()=>V(!1),children:"Collapse"})]}),eo?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"mt-2 text-[15px] font-semibold text-slate-900",children:eo.river_name}),(0,s.jsx)("div",{className:"text-xs text-slate-600",children:null!==(i=eo.gauge_label)&&void 0!==i?i:""}),(0,s.jsxs)("div",{className:"mt-1 text-[11px] text-slate-500",children:["Updated ",ey(null!==(g=null!==(n=eo.source_flow_observed_at)&&void 0!==n?n:eo.source_temp_observed_at)&&void 0!==g?g:eo.updated_at)," MT"]}),(0,s.jsxs)("div",{className:"mt-2 grid grid-cols-1 gap-0.5 text-[11px] text-slate-500",children:[(0,s.jsxs)("div",{children:["Flow source: ",ey(eo.source_flow_observed_at)," MT"]}),(0,s.jsxs)("div",{children:["Temp source: ",ey(eo.source_temp_observed_at)," MT"]}),(0,s.jsxs)("div",{children:["Weather/score: ",ey(eo.updated_at)," MT"]})]}),(0,s.jsx)("div",{className:"mt-2",children:(0,s.jsx)(ep,{tier:"HOT"===eo.bite_tier||"GOOD"===eo.bite_tier?"Good":"FAIR"===eo.bite_tier?"Fair":"TOUGH"===eo.bite_tier?"Tough":void 0})}),(0,s.jsxs)("div",{className:"mt-3 grid grid-cols-2 gap-x-4 gap-y-2 text-xs",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-slate-500",children:"Score"}),(0,s.jsx)("div",{className:"font-semibold text-slate-900",children:null!==(y=eo.fishability_score_calc)&&void 0!==y?y:"—"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-slate-500",children:"Flow"}),(0,s.jsx)("div",{className:"font-semibold text-slate-900",children:null!==(x=eo.flow_cfs)&&void 0!==x?x:"—"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-slate-500",children:"Temp"}),(0,s.jsx)("div",{className:"font-semibold text-slate-900",children:null!=eo.water_temp_f?"".concat(Number(eo.water_temp_f).toFixed(1),"\xb0F"):"—"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-slate-500",children:"Stability"}),(0,s.jsx)("div",{className:"font-semibold text-slate-900",children:null==eo.change_48h_pct_calc?"—":"".concat(Number(eo.change_48h_pct_calc).toFixed(1),"% 48h")})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-slate-500",children:"Ratio"}),(0,s.jsx)("div",{className:"font-semibold text-slate-900",children:null!=eo.flow_ratio_calc?"".concat(Number(eo.flow_ratio_calc).toFixed(2),"x"):"—"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-slate-500",children:"Hatch likelihood"}),(0,s.jsx)("div",{className:"font-semibold text-slate-900",children:eu})]})]}),(0,s.jsxs)("div",{className:"mt-2 text-[11px] text-slate-600",children:["Wind AM ",null!==(L=eo.wind_am_mph)&&void 0!==L?L:"—"," • PM ",null!==(S=eo.wind_pm_mph)&&void 0!==S?S:"—"]}),(0,s.jsx)("div",{className:"my-3 h-px bg-slate-200/80"}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"text-[11px] font-semibold uppercase tracking-wide text-slate-500",children:["Seasonal Intel (",ec.season,")"]}),(0,s.jsxs)("div",{className:"mt-1 text-xs text-slate-700",children:[(0,s.jsx)("span",{className:"font-semibold",children:"Likely bugs:"})," ",ec.likelyBugs]}),(0,s.jsxs)("div",{className:"mt-1 text-xs text-slate-700",children:[(0,s.jsx)("span",{className:"font-semibold",children:"Recommended approach:"})," ",ec.recommendedApproach]})]}),(0,s.jsx)("button",{className:"mt-3 w-full rounded-lg border border-slate-200/80 bg-white/70 px-2 py-1.5 text-left text-xs font-medium text-slate-700 hover:bg-slate-50",onClick:()=>Q(e=>!e),children:"How this score is calculated"}),K&&ed?(0,s.jsxs)("div",{className:"mt-2 rounded-lg bg-slate-50/70 p-2 text-[11px] text-slate-700",children:[(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-x-3 gap-y-1",children:[(0,s.jsx)("div",{children:"Flow Score"}),(0,s.jsx)("div",{className:"text-right font-semibold",children:eg(ed.flowScore)}),(0,s.jsx)("div",{children:"Stability Score"}),(0,s.jsx)("div",{className:"text-right font-semibold",children:eg(ed.stabilityScore)}),(0,s.jsx)("div",{children:"Thermal Score"}),(0,s.jsx)("div",{className:"text-right font-semibold",children:eg(ed.thermalScore)}),(0,s.jsx)("div",{children:"Wind Penalty"}),(0,s.jsx)("div",{className:"text-right font-semibold",children:eg(ed.windPenalty)}),(0,s.jsx)("div",{className:"border-t border-slate-200 pt-1 font-semibold",children:"Total Score"}),(0,s.jsx)("div",{className:"border-t border-slate-200 pt-1 text-right font-semibold",children:eg(ed.totalScore)})]}),(0,s.jsxs)("div",{className:"mt-2 border-t border-slate-200 pt-2",children:[(0,s.jsx)("div",{className:"mb-1 text-[10px] font-semibold uppercase tracking-wide text-slate-500",children:"Raw inputs"}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-x-3 gap-y-1",children:[(0,s.jsx)("div",{children:"Flow cfs"}),(0,s.jsx)("div",{className:"text-right",children:eg(eo.flow_cfs)}),(0,s.jsx)("div",{children:"Median flow"}),(0,s.jsx)("div",{className:"text-right",children:eg(eo.median_flow_cfs)}),(0,s.jsx)("div",{children:"Ratio"}),(0,s.jsxs)("div",{className:"text-right",children:[eg(eo.flow_ratio_calc,2),"x"]}),(0,s.jsx)("div",{children:"48h change"}),(0,s.jsxs)("div",{className:"text-right",children:[eg(eo.change_48h_pct_calc,1),"%"]}),(0,s.jsx)("div",{children:"Temp"}),(0,s.jsxs)("div",{className:"text-right",children:[eg(eo.water_temp_f,1),"\xb0F"]}),(0,s.jsx)("div",{children:"Wind AM / PM"}),(0,s.jsxs)("div",{className:"text-right",children:[eg(eo.wind_am_mph)," / ",eg(eo.wind_pm_mph)]})]}),(0,s.jsx)("div",{className:"mt-2 text-[10px] text-slate-500",children:"Components are estimated from current telemetry values; total score is the live MRI score."})]})]}):null]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"mt-2 text-sm font-semibold text-slate-900",children:"Montana River Intel"}),(0,s.jsx)("div",{className:"text-xs text-slate-600",children:"Tap a river in the list to preview details here."})]})]}):(0,s.jsx)("button",{className:"onx-glass rounded-xl px-3 py-2 text-xs font-medium text-white/90 hover:text-white",onClick:()=>V(!0),children:"Details"})}),(0,s.jsx)("div",{className:"absolute bottom-0 left-0 right-0 z-30",style:{transform:"translateY(".concat((T?P:Math.max(P,.75))*78,"%)"),transition:G?"none":"transform 180ms ease-out"},children:(0,s.jsx)("div",{className:"mx-auto max-w-6xl px-3 pb-3",children:(0,s.jsxs)("div",{className:"onx-glass overflow-hidden rounded-3xl shadow-2xl",children:[(0,s.jsx)("div",{className:"mx-auto mt-2 h-1.5 w-12 flex-shrink-0 cursor-grab rounded-full bg-white/25 active:cursor-grabbing",onPointerDown:eb,onTouchStart:eb,title:"Drag to expand/collapse"}),(0,s.jsxs)("div",{className:"flex items-center justify-between px-4 pt-3",children:[(0,s.jsxs)("div",{className:"text-sm font-semibold text-white",children:["Rivers (",ea.length,")"]}),(0,s.jsx)("button",{className:"text-xs text-white/80 hover:text-white",onClick:()=>{let e=!T;A(e),I(e?0:1)},children:T?"Collapse":"Expand"})]}),(0,s.jsx)("div",{className:"px-3 pb-3 pt-2",children:(0,s.jsxs)("div",{className:"max-h-[34vh] overflow-auto pr-1",children:[(0,s.jsx)("div",{className:"grid grid-cols-1 gap-2 sm:grid-cols-2 lg:grid-cols-3",children:ea.map(e=>{var t,r,l;return(0,s.jsx)("button",{onClick:()=>E(e.river_id),className:["rounded-2xl border text-left transition",e.river_id===z?"border-white/45 bg-white/15":"border-white/15 bg-white/5 hover:border-white/25"].join(" "),children:(0,s.jsxs)("div",{className:"p-3",children:[(0,s.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-sm font-semibold text-white",children:e.river_name}),(0,s.jsx)("div",{className:"text-xs text-white/70",children:null!==(t=e.gauge_label)&&void 0!==t?t:""})]}),(0,s.jsx)(ep,{tier:"HOT"===e.bite_tier||"GOOD"===e.bite_tier?"Good":"FAIR"===e.bite_tier?"Fair":"TOUGH"===e.bite_tier?"Tough":void 0})]}),(0,s.jsxs)("div",{className:"mt-2 grid grid-cols-3 gap-2 text-xs text-white/85",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-white/60",children:"Score"}),(0,s.jsx)("div",{className:"font-semibold",children:null!==(r=e.fishability_score_calc)&&void 0!==r?r:"—"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-white/60",children:"Flow"}),(0,s.jsx)("div",{className:"font-semibold",children:null!==(l=e.flow_cfs)&&void 0!==l?l:"—"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-white/60",children:"Temp"}),(0,s.jsx)("div",{className:"font-semibold",children:null!=e.water_temp_f?"".concat(Number(e.water_temp_f).toFixed(1),"\xb0"):"—"})]})]})]})},e.river_id)})}),0===ea.length?(0,s.jsx)("div",{className:"px-2 py-6 text-center text-sm text-white/70",children:"No rivers match your search/filter."}):null]})})]})})})]})}}},function(e){e.O(0,[932,402,93,971,117,744],function(){return e(e.s=2355)}),_N_E=e.O()}]);